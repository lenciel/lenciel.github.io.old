
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>@Lenciel</title>
  <meta name="author" content="Lenciel Li">

  
  <meta name="description" content="Table Of Contents Terminology / Reference Signed Requests Signature Base String Signing Key Signature编码 PLAINTEXT HMAC-SHA1 RSA-SHA1 OAuth请求头 OAuth &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://lenciel.cn/blog/page/10/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/github/lenciel" rel="alternate" title="@Lenciel" type="application/atom+xml">
  <!-- Facebook Open Graph
     Facebook Debugger: https://developers.facebook.com/tools/debug -->

<meta property="og:type" content="article" />
<meta property="og:url" content="http://lenciel.cn/blog/page/10/" />
<meta property="og:description" content="Table Of Contents Terminology / Reference Signed Requests Signature Base String Signing Key Signature编码 PLAINTEXT HMAC-SHA1 RSA-SHA1 OAuth请求头 OAuth &hellip;" />

<meta property="og:site_name" content="http://lenciel.cn" />
<meta property="article:author" content="https://plus.google.com/114787528537231301324">



<meta itemprop="description" content="Table Of Contents Terminology / Reference Signed Requests Signature Base String Signing Key Signature编码 PLAINTEXT HMAC-SHA1 RSA-SHA1 OAuth请求头 OAuth &hellip;" />

<!-- Combine multiple fonts into one request -->
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic|Patua+One|Yanone+Kaffeesatz" rel="stylesheet" type="text/css">
<!-- jQuery -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>

  <script>
  !function(g,s,q,r,d){r=g[r]=g[r]||function(){(r.q=r.q||[]).push(
  arguments)};d=s.createElement(q);q=s.getElementsByTagName(q)[0];
  d.src='//d1l6p2sc9645hc.cloudfront.net/tracker.js';q.parentNode.
  insertBefore(d,q)}(window,document,'script','_gs');

  _gs('GSN-360316-J');
</script>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-175991-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">@Lenciel</a></h1>
  
    <h2>Thoughts and Rants.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/github/lenciel" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:lenciel.cn" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/"><i class="icon-home"></i>Home</a></li>
  <li><a href="/blog/archives"><i class="icon-book-alt"></i>Archives</a><span class="divider"></span></li>
  <li><a href="/about"><i class="icon-user"></i>About</a><span class="divider"></span></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/07/oauth-introduction-and-tips/">Oauth: Introduction and Tips</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-22T09:53:00+08:00" pubdate data-updated="true">Jul 22<span>nd</span>, 2013</time>
        
         | <a href="/2013/07/oauth-introduction-and-tips/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><ul id="markdown-toc">
  <li><a href="#table-of-contents">Table Of Contents</a>    <ul>
      <li><a href="#terminology--reference">Terminology / Reference</a>        <ul>
          <li><a href="#signed-requests">Signed Requests</a>            <ul>
              <li><a href="#signature-base-string">Signature Base String</a>                <ul>
                  <li><a href="#signing-key">Signing Key</a></li>
                </ul>
              </li>
              <li><a href="#signature">Signature编码</a>                <ul>
                  <li><a href="#plaintext">PLAINTEXT</a></li>
                  <li><a href="#hmac-sha1">HMAC-SHA1</a></li>
                  <li><a href="#rsa-sha1">RSA-SHA1</a></li>
                </ul>
              </li>
              <li><a href="#oauth">OAuth请求头</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#oauth-10a-one-legged">OAuth 1.0a (one-legged)</a></li>
      <li><a href="#oauth-10a-two-legged">OAuth 1.0a (two-legged)</a></li>
      <li><a href="#oauth-10a-three-legged">OAuth 1.0a (three-legged)</a></li>
      <li><a href="#oauth-10a-echo">OAuth 1.0a (Echo)</a></li>
      <li><a href="#oauth-10a-xauth">OAuth 1.0a (xAuth)</a></li>
      <li><a href="#oauth-2-two-legged">OAuth 2 (two-legged)</a>        <ul>
          <li><a href="#client-credentials">Client Credentials</a></li>
          <li><a href="#resource-owner-password">Resource Owner Password</a></li>
        </ul>
      </li>
      <li><a href="#oauth-2-three-legged">OAuth 2 (three-legged)</a></li>
      <li><a href="#oauth-2-refresh-token">OAuth 2 (refresh token)</a></li>
      <li><a href="#tips--tricks">Tips &amp; Tricks</a>        <ul>
          <li><a href="#access-tokenrefresh-key">生成Access Token和Refresh Key</a>            <ul>
              <li><a href="#section">例子</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#references">References</a></li>
    </ul>
  </li>
</ul>

<h1 id="table-of-contents">Table Of Contents</h1>

<h2 id="terminology--reference">Terminology / Reference</h2>

<ul>
  <li>Signed / Signature
    <ul>
      <li>由一系列的HTTP request元素组成的一个字符串。</li>
    </ul>

    <p>这里说的HTTP request元素一般包括了<code>Request Method</code> <code>&amp;</code> <code>URL Query</code> <code>&amp;</code> <code>Parameters</code>, 并且这些元素用(<code>consumer_secret</code> <code>&amp;</code> <code>token_secret</code>)组成的key进行了加密。In some cases this may be the key, plaintext, or may use simply the <code>consumer_secret</code>, for RSA encryption.</p>
  </li>
  <li>Consumer Secret
    <ul>
      <li>由应用提供出来作为OAuth握手的保密的token</li>
    </ul>
  </li>
  <li>Consumer Key
    <ul>
      <li>由应用随Consumer Secret一起提供，用来做OAuth的握手的key</li>
    </ul>
  </li>
  <li>Nonce / UID
    <ul>
      <li>通常<code>32</code>个字符长度，由<code>a-zA-Z0-9</code>中的字符生成的一个独一无二的ID</li>
    </ul>
  </li>
  <li>OAuth Token
    <ul>
      <li>由服务器或者是其他Endpoint发送的，用来作为Request或者Access的token</li>
    </ul>
  </li>
  <li>OAuth Token Secret
    <ul>
      <li>作为特定token的响应被发送，用来进行 <code>exchanges / refreshing</code>.</li>
    </ul>
  </li>
  <li>Query
    <ul>
      <li>URL中的用 <code>?</code> 符号隔开的一些键值对部分。键和值之间用 <code>=</code> 分隔，例如 <code>?query=looks&amp;like=this</code></li>
    </ul>
  </li>
  <li>Parameter / Argument
    <ul>
      <li>一般指Query中的键，比如 <code>oauth_token="helloWorld"</code> 中 <code>oauth_token</code> 被称为一个 <code>parameter</code> 或者 <code>argument</code> 而 <code>helloWorld</code> 则是它的值。</li>
    </ul>
  </li>
  <li>PLAINTEXT
    <ul>
      <li>使用普通文本作为Signature的保存方式</li>
    </ul>
  </li>
  <li>HMAC-SHA1 <sup id="fnref:8"><a href="#fn:8" rel="footnote">1</a></sup>
    <ul>
      <li>Signature的保存方式，基于Secure Hash Algorithm(1)，是加密的文本</li>
    </ul>
  </li>
  <li>RSA-SHA1 <sup id="fnref:9"><a href="#fn:9" rel="footnote">2</a></sup>
    <ul>
      <li>Signature的保存方式，基于Secure Hash Algorithm(1)，由一对public/ private的key组成。</li>
    </ul>
  </li>
  <li>Service
    <ul>
      <li>服务方指信息的提供者，在OAuth语境中，Facebook/Twitter/腾讯/新浪等就是一个个的Service</li>
    </ul>
  </li>
  <li>Signature Method
    <ul>
      <li>OAuth接受的加密算法，包括: PLAINTEXT, HMAC-SHA1和RSA-SHA1</li>
    </ul>
  </li>
  <li>Value
    <ul>
      <li>键值对中的值</li>
    </ul>
  </li>
  <li>URL / URI
    <ul>
      <li>URL是URI的一种，你应该懂的吧</li>
    </ul>
  </li>
</ul>

<h3 id="signed-requests">Signed Requests</h3>

<blockquote>
  <p>本章描述的是OAuth 1.0</p>
</blockquote>

<p>对request签名(Sign)是非常重要的，本章主要解释签名流程和各个参数的作用。从数据流上来说，签名的过程就是把应用所获取和所生成的信息放到一个地方去：可以是通过 <code>OAuth</code> 头，也可以是 <code>Query</code> 字符串。</p>

<h4 id="signature-base-string">Signature Base String</h4>

<p>签名的基本组成有：request的 <code>Method</code>，request的 <code>URL</code> (如果是 <code>OAuth Echo</code>则是 <code>credentials uri</code>) 和 request的 <code>Query String</code>。没有加密前它看起来会是下面这样 (例子来自 <a href="https://dev.twitter.com/docs/auth/creating-signature">twitter</a>):</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">POST&amp;https%3A%2F%2Fapi.twitter.com%2F1%2Fstatuses%2Fupdate.json&amp;include_entities%3Dtrue%26oauth_consumer_key%3Dxvz1evFS4wEEPTGEFPHBog%26oauth_nonce%3DkYjzVBB8Y0ZFabxSWbWovY3uYSQ2pTgmZeNu2VS4cg%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1318622958%26oauth_token%3D370773112-GmHxMAgYyLbNEtIKZeRNFsMKPR9EyMZeS9weJAEb%26oauth_version%3D1.0%26status%3DHello%2520Ladies%2520%252B%2520Gentlemen%252C%2520a%2520signed%2520OAuth%2520request%2521</span></code></pre></td></tr></table></div></figure></notextile></div>

<h5 id="signing-key">Signing Key</h5>

<p>上面的 <code>signature base</code> 字符串会被加密。加密时用到的key就是 <em>signing key</em> ， 是由OAuth <code>Consumer Secret</code> 和 <code>Token Secret</code> 用 <code>&amp;</code> 字符连接起来组成的:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">kAcSOqF21Fu85e7zjz7ZN2U4ZRhfV3WpwPAoE3Z7kBw&amp;LswwdoUaIvS8ltyTt5jkRh4J50vUPVVHtR2YPi5kE</span></code></pre></td></tr></table></div></figure></notextile></div>

<hr />

<p><strong>Note:</strong> 如果是使用RSA或者xAuth， <code>signing key</code> 可能只有 <code>Consumer Secret</code> 部分外加一个可以省略的 <code>&amp;</code> 。 更多相关信息可以从mashape-oauth/lib/oauth.js的 <a href="https://github.com/Mashape/mashape-oauth/blob/master/lib/oauth.js#L233">233</a>行和 <a href="https://github.com/Mashape/mashape-oauth/blob/master/lib/oauth.js#L238">238</a>行了解。</p>

<hr />

<h4 id="signature">Signature编码</h4>

<p>有了 <code>signature base string</code> 和 <code>signature key</code> 之后，就需要从这两个字符串中提取信息完成编码。编码的方式共有三种：PLAINTEXT, HMAC, 或者是 RSA。</p>

<h5 id="plaintext">PLAINTEXT</h5>

<p>没有任何编码，直接传 <code>Signature Key</code></p>

<h5 id="hmac-sha1">HMAC-SHA1</h5>

<p>这种编码方式下，二进制格式的key被用来更新base，然后被编码成 <code>Base64</code> 放到<code>signature string</code>里面：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">tnnArxj06cWHq44gCs1OSKk/jLY=</span></code></pre></td></tr></table></div></figure></notextile></div>

<h5 id="rsa-sha1">RSA-SHA1</h5>

<p>这种更复杂但是更安全的方式是根据<code>Signature Base</code>来生成一对<code>private key</code>和<code>public key</code>进行加密。</p>

<p>然后在服务端，会用key来验证编码后的 <code>oauth_signature</code> 字段。</p>

<p><strong>Note:</strong> mashape-oauth/tests/oauth.js的第<a href="https://github.com/Mashape/mashape-oauth/blob/master/tests/oauth.js#L74">74</a>行说明了如何使用生成的<code>private key</code>来对<code>signature base</code>进行编码。</p>

<h4 id="oauth">OAuth请求头</h4>

<p>OAuth请求头包括了<code>oauth_signature</code> 和 <code>oauth_signature_method</code> 等参数及值。这些<code>oauth_*</code> 参数一般会用名字和其他<a href="https://github.com/Mashape/mashape-oauth/blob/master/lib/oauth.js#L111">复杂的规则</a>排序，相互之间用 <code>,</code> 或者是空格分隔。下面是一个取得Twitter的Request Token的例子:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
</pre></td><td class="code"><pre><code class="http"><span class="line"><span class="nf">POST</span> <span class="nn">/oauth/request_token</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span><span class="line"><span class="na">User-Agent</span><span class="o">:</span> <span class="l">themattharris&#39; HTTP Client</span>
</span><span class="line"><span class="na">Host</span><span class="o">:</span> <span class="l">api.twitter.com</span>
</span><span class="line"><span class="na">Accept</span><span class="o">:</span> <span class="l">*/*</span>
</span><span class="line"><span class="err">Authorization:</span>
</span><span class="line">        OAuth oauth_callback=&quot;http%3A%2F%2Flocalhost%2Fsign-in-with-twitter%2F&quot;,
</span><span class="line">              oauth_consumer_key=&quot;cChZNFj6T5R0TigYB9yd1w&quot;,
</span><span class="line">              oauth_nonce=&quot;ea9ec8429b68d6b77cd5600adbbb0456&quot;,
</span><span class="line">              oauth_signature=&quot;F1Li3tvehgcraF8DMJ7OyxO4w9Y%3D&quot;,
</span><span class="line">              oauth_signature_method=&quot;HMAC-SHA1&quot;,
</span><span class="line">              oauth_timestamp=&quot;1318467427&quot;,
</span><span class="line">              oauth_version=&quot;1.0&quot;
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><code>oauth_callback</code> 是整个认证过程完毕后的回调地址，默认情况下服务方会提供一个 <code>oauth_callback_confirmed</code> token。</p>

<p>下面是一个<code>response</code>的例子：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class="http"><span class="line"><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</span><span class="line"><span class="na">Date</span><span class="o">:</span> <span class="l">Thu, 13 Oct 2011 00:57:06 GMT</span>
</span><span class="line"><span class="na">Status</span><span class="o">:</span> <span class="l">200 OK</span>
</span><span class="line"><span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/html; charset=utf-8</span>
</span><span class="line"><span class="na">Content-Length</span><span class="o">:</span> <span class="l">146</span>
</span><span class="line"><span class="na">Pragma</span><span class="o">:</span> <span class="l">no-cache</span>
</span><span class="line"><span class="na">Expires</span><span class="o">:</span> <span class="l">Tue, 31 Mar 1981 05:00:00 GMT</span>
</span><span class="line"><span class="na">Cache-Control</span><span class="o">:</span> <span class="l">no-cache, no-store, must-revalidate, pre-check=0, post-check=0</span>
</span><span class="line"><span class="na">Vary</span><span class="o">:</span> <span class="l">Accept-Encoding</span>
</span><span class="line"><span class="na">Server</span><span class="o">:</span> <span class="l">tfe</span>
</span><span class="line">
</span><span class="line">oauth_token=NPcudxy0yU5T3tBzho7iCotZ3cnetKwcTIRlX0iwRl0<span class="err">&amp;</span>
</span><span class="line">oauth_token_secret=veNRnAWe6inFuo8o2u8SLLZLjolYDmDP7SzL0YfYI<span class="err">&amp;</span>
</span><span class="line">oauth_callback_confirmed=true
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>可以看到, <code>200</code> response 以及 <code>oauth_token</code>, <code>oauth_token_secret</code> 和 <code>oauth_callback_confirmed</code> 参数表示这次OAuth请求是成功的。接下来你就可以用 <code>oauth_token_secret</code> 来生成你的签名作为 <code>access token</code> 然后使用 <code>oauth_token</code>参数发送出去进行认证。</p>

<p>一般来说, <code>oauth_token</code> 发送的格式是 <code>?oauth_token=[token]</code> ，在认证的endpoint收到之后会进行一次 <code>3-Legged OAuth 1.0a</code> 并返回 <code>oauth_token</code> 和 <code>oauth_verifier</code>。返回的参数也会被用到 <code>Access Token</code> request<sup id="fnref:1"><a href="#fn:1" rel="footnote">3</a></sup>中去。</p>

<h2 id="oauth-10a-one-legged">OAuth 1.0a (one-legged)</h2>

<p>一般被叫成 <code>two-legged</code> 的OAuth其实是只有一步的。</p>

<p><img src="/downloads/images/oauth_flow_1.png" align="right" /></p>

<ol>
  <li>应用发送一个 <strong>signed</strong> request 到服务提供商，request里包括:
    <ul>
      <li><code>oauth_token</code> <em>Empty String</em></li>
      <li><code>oauth_consumer_key</code></li>
      <li><code>oauth_timestamp</code></li>
      <li><code>oauth_nonce</code></li>
      <li><code>oauth_signature</code></li>
      <li><code>oauth_signature_method</code></li>
      <li><code>oauth_version</code> <em>Optional</em></li>
    </ul>
  </li>
  <li>服务提供商验证后，提供相应的资源供应用访问。</li>
  <li>应用请求可以访问的资源。</li>
</ol>

<p>这种最简单的方式当然也是安全是漏洞最多的方式。通常如果你都已经想到要用OAuth了，就不该考虑这么简陋的方式了。</p>

<hr />

<p><strong>Note:</strong> Google 要求请求里面要带一个不是<code>oauth</code>开头的参数叫 <code>xoauth_requester_id</code><sup id="fnref:2"><a href="#fn:2" rel="footnote">4</a></sup>，这个要求在OAuth2里面过期了。</p>

<hr />

<h2 id="oauth-10a-two-legged">OAuth 1.0a (two-legged)</h2>

<p>真正的<code>two-legged</code>是1.0a版本的OAuth。</p>

<p><img src="/downloads/images/oauth_flow_2.png" align="right" /></p>

<ol>
  <li>应用发送一个 <strong>signed</strong> request到服务提供商请求一个 <code>Request Token</code>，request里包括:
    <ul>
      <li><code>oauth_consumer_key</code></li>
      <li><code>oauth_timestamp</code></li>
      <li><code>oauth_nonce</code></li>
      <li><code>oauth_signature</code></li>
      <li><code>oauth_signature_method</code></li>
      <li><code>oauth_version</code> <em>可选</em></li>
    </ul>
  </li>
  <li>服务提供商返回 <code>Request Token</code>:
    <ul>
      <li><code>oauth_token</code></li>
      <li><code>oauth_token_secret</code></li>
      <li>… 其他额外的参数</li>
    </ul>
  </li>
  <li>应用再次发送<strong>signed</strong> request来用<code>Request Token</code>换<code>Access Token</code>，请求中包括：
    <ul>
      <li><code>oauth_token</code> <em>Request Token</em></li>
      <li><code>oauth_consumer_key</code></li>
      <li><code>oauth_nonce</code></li>
      <li><code>oauth_signature</code></li>
      <li><code>oauth_signature_method</code></li>
      <li><code>oauth_version</code></li>
    </ul>
  </li>
  <li>服务提供商返回 <code>Access Token</code> 和 <code>Token Secret</code>，整个payload的参数和第二步一样主要是<code>oauth_token</code>和<code>oauth_token_secret</code>。</li>
  <li>应用使用<code>oauth_token</code> 和 <code>oauth_token_secret</code> 来访问被权限保护的资源。</li>
</ol>

<p>这里我们可以看到安全性被增强了，而应用开发者不会有太多的工作，用户更是完全觉察不到。</p>

<h2 id="oauth-10a-three-legged">OAuth 1.0a (three-legged)</h2>

<p>最完备同时也是带来最多麻烦的一个版本，特别是引入了需要用户操作来确认的部分，增加了开发和交互上的复杂度。一开始推出的时候，让很多用户感到不知所措。</p>

<p><img src="/downloads/images/oauth_flow_3.png" align="right" /></p>

<ol>
  <li>应用发送一个 <strong>signed</strong> request到服务提供商请求一个 <code>Request Token</code>，request里包括:
    <ul>
      <li><code>oauth_consumer_key</code></li>
      <li><code>oauth_timestamp</code></li>
      <li><code>oauth_nonce</code></li>
      <li><code>oauth_signature</code></li>
      <li><code>oauth_signature_method</code></li>
      <li><code>oauth_version</code> <em>Optional</em></li>
      <li><code>oauth_callback</code></li>
    </ul>
  </li>
  <li>服务提供商返回 <code>Request Token</code>:
    <ul>
      <li><code>oauth_token</code></li>
      <li><code>oauth_token_secret</code></li>
      <li><code>oauth_callback_confirmed</code></li>
      <li>… Additional Parameters / Arguments</li>
    </ul>
  </li>
  <li>返回包含下面参数的url
    <ul>
      <li><code>oauth_token</code></li>
    </ul>
  </li>
  <li>弹出窗口访问返回的url，要求用户授权</li>
  <li>用户授权</li>
  <li>返回到应用中，并保存下面的参数:
    <ul>
      <li><code>oauth_token</code></li>
      <li><code>oauth_verifier</code></li>
    </ul>
  </li>
  <li>应用发送<strong>signed</strong> request，用<code>Request Token</code> / <code>Verifier</code> 换 <code>Access Token</code>, 请求中包括：
    <ul>
      <li><code>oauth_token</code> <em>Request Token;</em></li>
      <li><code>oauth_consumer_key</code></li>
      <li><code>oauth_nonce</code></li>
      <li><code>oauth_signature</code></li>
      <li><code>oauth_signature_method</code></li>
      <li><code>oauth_version</code></li>
      <li><code>oauth_verifier</code></li>
    </ul>
  </li>
  <li>服务提供商返回 <code>Access Token</code> 和 <code>Token Secret</code>，整个payload的参数和第二步一样主要是<code>oauth_token</code>和<code>oauth_token_secret</code>。</li>
  <li>应用使用<code>oauth_token</code> 和 <code>oauth_token_secret</code> 来访问被权限保护的资源。</li>
</ol>

<hr />

<p><strong>Note:</strong> 在<em>第6步</em> 如果 <code>oauth_verifier</code> 没有被发送，那么就会认证失败。只有极少数的实现可以接受只发送<code>oauth_token</code>，这样的服务提供商被认为是不完整的实现了OAuth 1.0a 3-Legged。</p>

<hr />

<h2 id="oauth-10a-echo">OAuth 1.0a (Echo)</h2>

<p>非主流的一种实现，但是确实是存在的：发明者是Twitter的Raffi。这种实现允许在首次发送的请求token里面多带两个header，这样可以通过代理的方式在代理服务商那里对原始服务商的用户进行认证。</p>

<p><img src="/downloads/images/oauth_flow_4.png" align="right" /></p>

<ol>
  <li>应用发送一个 <strong>signed</strong> request到代理服务提供商，request里包括:
    <ul>
      <li><code>oauth_consumer_key</code></li>
      <li><code>oauth_timestamp</code></li>
      <li><code>oauth_nonce</code></li>
      <li><code>oauth_signature</code></li>
      <li><code>oauth_signature_method</code></li>
      <li><code>oauth_version</code> <em>Optional</em></li>
      <li><code>oauth_callback</code></li>
    </ul>

    <p>还包括额外的header:
 - <code>X-Auth-Service-Provider</code>
 - <code>X-Verify-Credentials-Authorization</code></p>
  </li>
  <li>代理服务商拿到额外的header信息到原始服务商认证</li>
  <li>代理服务商认证通过后，可以返回受限资源的url给应用。</li>
</ol>

<h2 id="oauth-10a-xauth">OAuth 1.0a (xAuth)</h2>

<p>xAuth是一种桌面程序或者手机程序（没有使用webview等控件不能完成完整流程的程序）使用的OAuth方式。它通过提供用户的<code>email</code>和<code>password</code>给服务器提供商来换取<code>access token</code>。 </p>

<p>这种方式返回的一般是具有只读性质的access token，并且这种token能操作的资源也是有限的。比如Twitter的DM（类似私信）就不能使用xAuth而必须用完整的<code>three-legged</code>流程获取token才能取到。</p>

<p><img src="/downloads/images/oauth_flow_5.png" align="right" /></p>

<ol>
  <li>应用请求用户的Credentials</li>
  <li>应用发送一个 <strong>signed</strong> request到服务提供商请求一个 <code>Access Token</code>，request里包括:
    <ul>
      <li><code>oauth_consumer_key</code></li>
      <li><code>oauth_timestamp</code></li>
      <li><code>oauth_nonce</code></li>
      <li><code>oauth_signature</code></li>
      <li><code>oauth_signature_method</code></li>
      <li><code>oauth_version</code> <em>Optional</em></li>
      <li><code>oauth_callback</code></li>
    </ul>

    <p>额外还包括:
 - <code>x_auth_mode</code> = <code>client_auth</code>
 - <code>x_auth_username</code>
 - <code>x_auth_password</code>
 - <code>x_auth_permission</code> <em>可选;</em><sup id="fnref:3"><a href="#fn:3" rel="footnote">5</a></sup></p>
  </li>
  <li>服务提供商验证用户的Credentials之后返回Access Token
    <ul>
      <li><code>oauth_token</code></li>
      <li><code>oauth_token_secret</code></li>
    </ul>
  </li>
  <li>应用使用<code>Access Token</code>来访问被权限保护的资源。</li>
</ol>

<h2 id="oauth-2-two-legged">OAuth 2 (two-legged)</h2>

<p>目前为止最容易解释的一种流程，也被称为 <em>Client Credentials</em> 认证流程<sup id="fnref:4"><a href="#fn:4" rel="footnote">6</a></sup>，也有一种 <em>Resource Owner Password</em> 流程属于这类。</p>

<h3 id="client-credentials">Client Credentials</h3>

<ol>
  <li>应用发送请求给服务提供商:
    <ul>
      <li><code>grant_type</code> = <code>client_credentials</code></li>
    </ul>
  </li>
</ol>

<p>如果不是用的 <code>Authorization</code> header:
  - <code>client_id</code>
  - <code>client_secret</code>
2. 应用服务商返回 <code>Access Token</code>等信息:
    - <code>access_token</code>
    - <code>expires_in</code>
    - <code>token_type</code></p>

<h3 id="resource-owner-password">Resource Owner Password</h3>

<p>基本上就是 <code>OAuth 1.0a Echo</code> 流程，但是去掉了签名等复杂的部分。</p>

<ol>
  <li>应用向resource owner（一般就是用户)请求credentials
    <ul>
      <li><code>username</code></li>
      <li><code>password</code></li>
    </ul>
  </li>
  <li>应用向服务提供商发送request，请求内容为:
    <ul>
      <li><code>grant_type</code> = <code>password</code></li>
      <li><code>username</code></li>
      <li><code>password</code></li>
    </ul>

    <p>其格式如下:</p>

    <p><code>
 grant_type=password&amp;username=my_username&amp;password=my_password
</code></p>

    <p>如果不是用的 <code>Authorization</code> header, 下面的也需要被放到request里面:
 - <code>client_id</code>
 - <code>client_secret</code></p>

    <p>整个加起来回是：</p>

    <p><code>
 grant_type=password&amp;username=my_username&amp;password=my_password&amp;client_id=random_string&amp;client_secret=random_secret
</code></p>
  </li>
  <li>应用服务商返回 <code>Access Token</code>等信息:
    <ul>
      <li><code>access_token</code></li>
      <li><code>expires_in</code></li>
      <li><code>token_type</code></li>
    </ul>
  </li>
</ol>

<h2 id="oauth-2-three-legged">OAuth 2 (three-legged)</h2>

<p>同样去掉了很多复杂的步骤。</p>

<ol>
  <li>应用把用户引导到认证页面:
    <ul>
      <li><code>client_id</code></li>
      <li><code>redirect_uri</code></li>
      <li><code>response_type</code><sup id="fnref:5"><a href="#fn:5" rel="footnote">7</a></sup></li>
      <li><code>state</code> <em>可选;</em> 防止CSRF<sup id="fnref:6"><a href="#fn:6" rel="footnote">8</a></sup></li>
      <li><code>scope</code> <em>可选;</em> 你可以获取的资源范围</li>
    </ul>

    <p>一个例子（为了可读性没有进行Encode）:</p>

    <p><code>
https://oauth_service/login/oauth/authorize?client_id=3MVG9lKcPoNINVB&amp;redirect_uri=http://localhost/oauth/code_callback&amp;scope=user
</code></p>
  </li>
  <li>用户登录到服务中，批准应用申请权限。</li>
  <li>服务提供商把用户重定向到 <code>redirect_url</code> 并带上:
    <ul>
      <li><code>code</code></li>
      <li><code>state</code></li>
    </ul>
  </li>
  <li>应用使用 <code>code</code> 用来请求 <code>Access Token</code>:
    <ul>
      <li><code>client_id</code></li>
      <li><code>client_secret</code></li>
      <li><code>code</code></li>
      <li><code>redirect_uri</code> <em>可选;</em><sup id="fnref:7"><a href="#fn:7" rel="footnote">9</a></sup></li>
      <li><code>grant_type</code> = <code>"authorization_code"</code> [^7]</li>
    </ul>
  </li>
  <li>如果 <code>client_id</code> 和 <code>client_secret</code> 正确，服务提供商调用回调到 <code>redirect_url</code> 返回 <code>access_token</code>等信息:
    <ul>
      <li><code>access_token</code></li>
      <li><code>expires_in</code></li>
      <li><code>refresh_token</code></li>
    </ul>
  </li>
  <li>应用保存 <code>access_token</code> 并使用。
    <ul>
      <li>一般来说保存到session或者是cookie里，然后放在 <code>Authorization: [Bearer] access_token</code> header里面用，其中<code>[Bearer]</code>是 <code>Header Authorization Bearer Name</code>，如<code>Bearer</code>, <code>OAuth</code>, <code>MAC</code>等。</li>
    </ul>
  </li>
</ol>

<hr />

<p><strong>有趣的事实:</strong> 有些RFC里面的规定，比如scope的分隔符用空格等，根本没有人遵守。所以开发者根本不知道API会在下个版本变成什么样子。</p>

<hr />

<h2 id="oauth-2-refresh-token">OAuth 2 (refresh token)</h2>

<p>在OAuth2中，<code>access_token</code>一般是有有效期的。一个过期的token被使用时，服务器会返回一个token过期的错误，并带上<code>refresh_token</code>。应用使用<code>refresh token</code>获取新的<code>access_token</code>会比前面描述的流程简单得多。</p>

<ol>
  <li>发送请求到服务提供商的<code>Refresh Token URI</code>:
    <ul>
      <li><code>grant_type</code> = <code>"refresh_token"</code></li>
      <li><code>scope</code> <em>可选;</em> 更新时不能指定之前没有的scope</li>
      <li><code>refresh_token</code></li>
      <li><code>client_id</code></li>
      <li><code>client_secret</code></li>
    </ul>
  </li>
  <li>服务提供商验证参数后返回:
    <ul>
      <li><code>access_token</code></li>
      <li><code>issued_at</code></li>
    </ul>
  </li>
</ol>

<h2 id="tips--tricks">Tips &amp; Tricks</h2>

<h3 id="access-tokenrefresh-key">生成Access Token和Refresh Key</h3>

<p>最好使用uuid，也就是固定长度的随机字符组成的字符串。</p>

<h4 id="section">例子</h4>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">var</span> <span class="nx">OAuth</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mashape-oauth&#39;</span><span class="p">).</span><span class="nx">OAuth</span><span class="p">,</span>
</span><span class="line">    <span class="nx">access_token</span> <span class="o">=</span> <span class="nx">OAuth</span><span class="p">.</span><span class="nx">nonce</span><span class="p">(</span><span class="cm">/* Length, Default 32 */</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="references">References</h2>

<ol>
  <li><a href="http://www.flickr.com/services/api/auth.oauth.html">Authorizing with OAuth</a> - Flickr Documentation</li>
  <li><a href="https://confluence.atlassian.com/display/BITBUCKET/OAuth+on+Bitbucket">OAuth on Bitbucket</a> - Bitbucket Documentation</li>
  <li><a href="https://dev.twitter.com/docs/auth/oauth">OAuth Documentation</a> - Twitter Documentation</li>
  <li><a href="http://2.bp.blogspot.com/-Va1Rp3-r898/TZiVh9xEJDI/AAAAAAAAAMw/8ImBIW_dXuY/s1600/OAuth-legs.png">OAuth Extended Flows</a></li>
  <li><a href="https://code.google.com/p/oauth-php/wiki/ConsumerHowTo#Two-legged_OAuth">2-Legged OAuth</a> - OAuth-PHP</li>
  <li><a href="http://oauth.googlecode.com/svn/spec/ext/consumer_request/1.0/drafts/2/spec.html">OAuth for Consumer Requests</a></li>
  <li><a href="http://term.ie/oauth/example/">OAuth Example</a> - term.ie</li>
  <li><a href="http://hueniverse.com/oauth/guide/">OAuth 1.0 Guide</a> - Heuniverse</li>
  <li><a href="http://oauth.net/core/diagram.png">OAuth 1.0a Diagram</a></li>
  <li><a href="http://wiki.oauth.net">OAuth Wiki</a></li>
  <li><a href="http://architects.dzone.com/articles/2-legged-oauth-oauth-10-and-20">2-Legged OAuth 1.0 &amp; 2.0</a> - DZone</li>
  <li><a href="https://developers.google.com/accounts/docs/OAuth">OAuth</a> &amp; <a href="https://developers.google.com/accounts/docs/OAuth2">OAuth2</a> - Google Documentation</li>
  <li><a href="http://blog.nerdbank.net/2011/06/what-is-2-legged-oauth.html">What is 2-legged OAuth?</a> - Nerdbank</li>
  <li><a href="http://en.wikipedia.org/wiki/OAuth#List_of_OAuth_service_providers">List of Service Providers</a> - Wikipedia</li>
  <li><a href="http://developers.mobypicture.com/documentation/authentication/oauth-echo/">OAuth Echo</a> - mobypicture</li>
  <li><a href="https://dev.twitter.com/docs/auth/oauth/oauth-echo">OAuth Echo</a> - Twitter</li>
  <li><a href="http://developer.vimeo.com/apis/advanced">Advanced API</a> - Vimeo Developer();</li>
  <li><a href="https://dev.twitter.com/docs/oauth/xauth">About xAuth</a> - Twitter xAuth Documentation</li>
  <li><a href="https://dev.twitter.com/docs/auth/implementing-sign-twitter">Implementing Sign-in</a> - Twitter Sign-in Documentation</li>
  <li><a href="http://tools.ietf.org/html/rfc6749">RFC6749</a> - IETF</li>
  <li><a href="http://developer.github.com/v3/oauth/">Web Application Flow</a> - Github OAuth2</li>
  <li><a href="http://www.salesforce.com/us/developer/docs/api_rest/Content/quickstart_oauth.htm">OAuth2 Quickstart</a> - Salesforce</li>
  <li><a href="https://developers.geoloqi.com/api/authentication">Authentication Mechanisms</a> - Geoloqi</li>
  <li><a href="http://www.salesforce.com/us/developer/docs/api_rest/Content/intro_understanding_web_server_oauth_flow.htm">Understanding Web Server OAuth Flow</a> - Salesforce</li>
  <li><a href="http://blog.springsource.org/2011/11/30/10317/">CSRF &amp; OAuth2</a> - Springsource</li>
  <li><a href="https://tools.ietf.org/html/draft-ietf-oauth-v2-31">OAuth v2-31</a> - IETF</li>
  <li><a href="http://techblog.hybris.com/2012/06/11/oauth2-resource-owner-password-flow/">Resource Owner Flow</a> - Hybris</li>
</ol>

<div class="footnotes">
  <ol>
    <li id="fn:8">
      <p><a href="http://en.wikipedia.org/wiki/Hash-based_message_authentication_code">Hash based message authentication code</a>.<a href="#fnref:8" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:9">
      <p><a href="http://en.wikipedia.org/wiki/RSA_(algorithm\)">RSA Algorithm</a>.<a href="#fnref:9" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:1">
      <p><a href="https://dev.twitter.com/docs/auth/implementing-sign-twitter">Implementing sign twitter</a>.<a href="#fnref:1" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p><a href="https://developers.google.com/google-apps/gmail/oauth_protocol#oauth_request_url">Oauth request url</a>.<a href="#fnref:2" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:3">
      <p><a href="http://developer.vimeo.com/apis/advanced">Vimeo API Advanced</a><a href="#fnref:3" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:4">
      <p><a href="https://tools.ietf.org/html/draft-ietf-oauth-v2-31#section-4.4">IETF OATUH V2 Section 4.4</a>.<a href="#fnref:4" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:5">
      <p><a href="http://tools.ietf.org/html/draft-ietf-oauth-v2-31#section-4.1.1">IETF OATUH V2 Section 4.1.1</a>.<a href="#fnref:5" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:6">
      <p><a href="http://blog.springsource.org/2011/11/30/10317/">CROSS SITE REQUEST FORGERY AND OAUTH2</a>.<a href="#fnref:6" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:7">
      <p><a href="http://tools.ietf.org/html/rfc6749#section-4.1.3">RFC6749</a>.<a href="#fnref:7" rel="reference">&#8617;</a></p>
    </li>
  </ol>
</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/07/tmux-introduction-and-tips/">Tmux: Introduction and Tips</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-21T14:02:00+08:00" pubdate data-updated="true">Jul 21<span>st</span>, 2013</time>
        
         | <a href="/2013/07/tmux-introduction-and-tips/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/downloads/images/tmux_tips_1.png" alt="tmux screenshot 1" title="Don't touch me..." /></p>

<h3 id="section"><strong>简介</strong></h3>

<p><code>tmux</code> ,其实就是 <code>terminal multiplexer</code> 的简称。使用tmux你可以把多个任务同时运行起来，使用不同的 <code>tmux</code> 窗口来查看它们。你也可以 <code>detach</code> 一个 <code>session</code>，也就是让一个窗口的活动，比如编译这种耗时你又不希望断开的活动，放到后台去运行。如果你使用过 <code>screen</code> 对 <code>detach</code> 一个 <code>session</code> 应该非常熟悉。其实初用 <code>tmux</code> 的时候，它很大程度上就像一个 <code>GNU-Session</code> 外加很多窗口管理的功能。而且由于 <code>tmux</code> 使用了 <code>client-server</code> 架构，我们可以在一个总控的地方去操作所有的窗口和pannel，甚至可以在一个窗口里面切换不同的 <code>session</code>。</p>

<h4 id="tmux"><strong>tmux的安装</strong></h4>

<p>用你的Linux package manager或者如果你和我一样在OSX可以用<code>brew</code>。另外，iTerm2<a href="http://code.google.com/p/iterm2/wiki/TmuxIntegration">集成了</a>对<code>tmux</code>的支持，它也是很多Mac上的<a href="http://tangledhelix.com/blog/2012/04/28/iterm2-keymaps-for-tmux/">程序员</a>最爱的Terminal。</p>

<h4 id="session"><strong>创建一个具名的Session</strong></h4>

<p>由于使用 <code>tmux</code> 可以在一个电脑上创建多个 <code>session</code> ，为了更好的管理它们我们一般可以使用名字来辨识这些 <code>session</code> 。
比如下面的命令可以创建一个叫 <code>basic</code> 的 <code>session</code>：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nv">$ </span>tmux -new -s basic
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>回车之后就会进入一个新的 <code>session</code> 里面。可以看到具名的<code>session</code>的<code>terminal</code>和正常打开<code>iTerm2</code>大致相同，没有特别之处。
这个时候我们敲<code>exit</code>就会回到原来的<code>terminal</code>中去。</p>

<h4 id="detaching--attaching"><strong>Detaching 和 Attaching</strong></h4>

<p>使用<code>tmux</code>一大好处就是我们可以启动<code>terminal</code>，运行一个任务在后台，然后<code>detach</code>这个<code>session</code>。如果在一般的<code>session</code>里面工作，一旦我们关闭了窗口，跑在里面的所有程序都会被退出。
但是如果是使用了<code>detach</code>，我们可以再<code>attach</code>回去。下面演示一个例子。</p>

<p>在创建的具名<code>session</code> “basic”里面运行<code>top</code>，然后使用<code>Ctrl-b + d</code>来<code>detach</code>这个<code>session</code>。</p>

<p>首先来学习一下<code>Ctrl+b</code>这样的<code>Command Prefix</code>。因为<code>tmux</code>是一个terminal管家，我们需要有一个办法告诉<code>tmux</code>我们敲击的是需要<code>tmux</code>处理的命令还是传给terminal的。如果定义了<code>Ctrl-b</code>为命令前缀，就是说我们一定要先敲这个前缀，然后执行一个命令，比如<code>d</code>，表示我们要<code>detach</code>。要记住前缀输入之后要松开手，不要在不松手的情况下发命令给<code>tmux</code>。</p>

<p>由于这个前缀是可以自定义的，所以后面我们记为<code>Prefix</code>而不再用<code>Ctrl-b</code>。</p>

<p>然后我们可以使用下面的命令对<code>session</code>进行<code>list</code>、<code>attach</code>和<code>delete</code>：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nv">$ </span>tmux ls
</span><span class="line">0: 1 windows <span class="o">(</span>created Thu Sep 27 10:16:16 2012<span class="o">)</span> <span class="o">[</span>121x22<span class="o">]</span>
</span><span class="line">basic: 1 windows <span class="o">(</span>created Thu Sep 27 14:32:50 2012<span class="o">)</span> <span class="o">[</span>122x22<span class="o">]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>可以看到目前有两个存活的<code>session</code>，一个是刚刚创建的<code>basic</code></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nv">$ </span>tmux <span class="nb">kill</span>-session -t 0
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>杀掉我们不需要的那个</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nv">$ </span>tmux ls
</span><span class="line">basic: 1 windows <span class="o">(</span>created Thu Sep 27 14:32:50 2012<span class="o">)</span> <span class="o">[</span>122x22<span class="o">]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>再次attach的时候可以不带<code>-t</code>，因为只有<code>basic</code>这个<code>session</code>还活着。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nv">$ </span>tmux attach
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>后面我们可以看到在session之间进行切换还有更多更方便的办法。</p>

<h4 id="section-1"><strong>窗口</strong></h4>

<p>很多时候我们都需要打开窗口运行多个任务。这种情况比较适用于<code>tmux</code>的窗口概念：用起来和现代操作系统里面的<code>tab</code>类似。</p>

<p>新建一个窗口很容易</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">tmux new -s windows -n shell
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><code>-s</code>是对<code>session</code>进行命名的，<code>-n</code>是用来对窗口进行命名的。</p>

<ul>
  <li>在当前的<code>session</code>里面新建一个窗口: <code>Prefix+C</code></li>
  <li>要给窗口命名：<code>Prefix+</code></li>
  <li>在已有的窗口间跳转： <code>Prefix+n/Prefix+p</code></li>
  <li>窗口较多的时候跳转： <code>Prefix+序列号</code></li>
  <li>要关掉窗口： <code>exit</code>或者<code>Prefix+&amp;</code></li>
  <li>要搜索窗口：<code>Prefix+f</code>或者 <code>Prefix+w</code></li>
</ul>

<h4 id="section-2"><strong>分栏</strong></h4>

<ul>
  <li>竖分: <code>Prefix+%</code></li>
  <li>横分: <code>Prefix+"</code>   </li>
  <li>在分栏中切换: <code>Prefix+o</code>   </li>
  <li>在分栏中切换: <code>Prefix+方向键</code></li>
  <li>在不同的布局间切换: <code>Prefix+space</code></li>
  <li>关闭: <code>Prefix+x</code></li>
</ul>

<h4 id="section-3"><strong>命令行模式</strong></h4>

<p><code>Prefix+:</code></p>

<h4 id="section-4"><strong>取得所有的快捷键</strong></h4>

<p><code>Prefix+?</code></p>

<p>二、配置tmux</p>

<p>首先在系统设置里面把<code>CapsLock</code>这枚废材按键map成<code>ctrl</code>。然后是把Prefix配置成<code>ctrl+a</code>而不是<code>ctrl+b</code>，这样主要是为了按起来方便顺手。</p>

<p>另外可以让窗口的序列号从1开始分配，这样初始窗口不会是0，那个你需要手伸很远才能按到的键。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nb">set</span> -g base-index 1
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>同理分栏的序列号也可以从1开始：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">setw -g pane-base-index 1
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>另外一般需要把发送命令的延迟设置为没延迟</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nb">set</span> -sg escape-time 1
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>完整的配置文件在<a href="https://github.com/lenciel/oh-my-zsh/blob/master/dot_files/tmux.conf">这里</a>：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span> (tmux.conf)</span> <a href="/downloads/code/tmux.conf">download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># zsh is kinda tight</span>
</span><span class="line"><span class="nb">set</span>-option -g default-shell <span class="nv">$SHELL</span>
</span><span class="line">
</span><span class="line"><span class="c"># copy and paster</span>
</span><span class="line"><span class="nb">set</span>-option -g default-command <span class="s2">&quot;reattach-to-user-namespace -l zsh&quot;</span>
</span><span class="line">
</span><span class="line"><span class="c"># look good</span>
</span><span class="line"><span class="nb">set</span> -g default-terminal <span class="s2">&quot;screen-256color&quot;</span>
</span><span class="line">
</span><span class="line"><span class="c"># act like GNU screen</span>
</span><span class="line"><span class="nb">set</span> -g prefix C-a
</span><span class="line">unbind C-b
</span><span class="line">
</span><span class="line"><span class="nb">set</span> -sg escape-time 1
</span><span class="line"><span class="nb">set</span> -g base-index 1
</span><span class="line">setw -g pane-base-index 1
</span><span class="line">
</span><span class="line"><span class="nb">bind </span>r <span class="nb">source</span>-file ~/.tmux.conf <span class="se">\;</span> display <span class="s2">&quot;Reloaded!&quot;</span>
</span><span class="line">
</span><span class="line"><span class="nb">bind</span> - split-window -v
</span><span class="line"><span class="nb">bind</span> | split-window -h
</span><span class="line">
</span><span class="line"><span class="c"># act like vim</span>
</span><span class="line">setw -g mode-keys vi
</span><span class="line"><span class="nb">bind </span>h <span class="k">select</span>-pane -L
</span><span class="line"><span class="nb">bind </span>j <span class="k">select</span>-pane -D
</span><span class="line"><span class="nb">bind </span>k <span class="k">select</span>-pane -U
</span><span class="line"><span class="nb">bind </span>l <span class="k">select</span>-pane -R
</span><span class="line"><span class="nb">bind</span> -r C-h <span class="k">select</span>-window -t :-
</span><span class="line"><span class="nb">bind</span> -r C-l <span class="k">select</span>-window -t :+
</span><span class="line">unbind <span class="o">[</span>
</span><span class="line"><span class="nb">bind</span> <span class="sb">`</span> copy-mode
</span><span class="line">unbind p
</span><span class="line"><span class="nb">bind </span>p paste-buffer
</span><span class="line"><span class="nb">bind</span> -t vi-copy v begin-selection
</span><span class="line"><span class="nb">bind</span> -t vi-copy y copy-selection
</span><span class="line">
</span><span class="line"><span class="c"># after copying to a tmux buffer, hit y again to copy to clipboard</span>
</span><span class="line"><span class="nb">bind </span>y run <span class="s2">&quot;tmux save-buffer - | reattach-to-user-namespace pbcopy&quot;</span>
</span><span class="line">
</span><span class="line"><span class="c"># resize pane</span>
</span><span class="line"><span class="nb">bind</span> -r H resize-pane -L 5
</span><span class="line"><span class="nb">bind</span> -r J resize-pane -D 5
</span><span class="line"><span class="nb">bind</span> -r K resize-pane -U 5
</span><span class="line"><span class="nb">bind</span> -r L resize-pane -R 5
</span><span class="line">
</span><span class="line"><span class="c"># enable mouse</span>
</span><span class="line">setw -g mode-mouse on
</span><span class="line"><span class="nb">set</span> -g mouse-select-pane on
</span><span class="line"><span class="nb">set</span> -g mouse-resize-pane on
</span><span class="line"><span class="nb">set</span> -g mouse-select-window on
</span><span class="line">
</span><span class="line">
</span><span class="line">setw -g window-status-fg cyan
</span><span class="line">setw -g window-status-bg default
</span><span class="line">setw -g window-status-attr dim
</span><span class="line">setw -g window-status-current-fg white
</span><span class="line">setw -g window-status-current-bg red
</span><span class="line">setw -g window-status-current-att bright
</span><span class="line">
</span><span class="line"><span class="nb">set</span> -g status-interval 60
</span><span class="line"><span class="nb">set</span> -g status-justify centre
</span><span class="line">setw -g monitor-activity on
</span><span class="line"><span class="nb">set</span> -g visual-activity on
</span><span class="line">
</span><span class="line"><span class="nb">set</span> -g terminal-overrides <span class="s2">&quot;xterm*:XT:smcup@:rmcup@:kUPS=\eOA:kDN5=\eOB:kLFT5=\eOD:kRIT5=\eOC&quot;</span>
</span><span class="line"><span class="nb">set</span> -g <span class="nb">history</span>-limit 30000
</span><span class="line">setw -g alternate-screen on
</span><span class="line"><span class="nb">set</span> -s escape-time 50
</span><span class="line">
</span><span class="line"><span class="nb">set</span>-window-option -g window-status-current-format <span class="s2">&quot;#[fg=colour235, bg=colour27]⮀#[fg=colour255, bg=colour27] #I ⮁ #W #[fg=colour27, bg=colour235]⮀&quot;</span>
</span><span class="line"><span class="nb">source</span> <span class="s2">&quot;/Users/lenciel/Library/Python/2.7/lib/python/site-packages/powerline/bindings/tmux/powerline.conf&quot;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/07/big-brother/">1984</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-20T01:11:00+08:00" pubdate data-updated="true">Jul 20<span>th</span>, 2013</time>
        
         | <a href="/2013/07/big-brother/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/downloads/images/1984.gif" alt="1984" title="Don't touch me..." /></p>

<blockquote><p>&#8220;From the age of Big Brother, from the age of the Thought Police, from a dead man … greetings.&#8221;</p><footer><strong>George Orwell</strong> <cite>Nineteen Eighty-Four (1984)</cite></footer></blockquote>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/07/go-and-love-more/">Go and Love More</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-18T21:14:00+08:00" pubdate data-updated="true">Jul 18<span>th</span>, 2013</time>
        
         | <a href="/2013/07/go-and-love-more/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/downloads/images/go_and_love_more.gif" alt="Go and love more" title="Don't touch me..." /></p>

<blockquote><p>&#8220;Go and love some more.&#8221;</p><footer><strong>Hal Ashby</strong> <cite><a href="http://en.wikipedia.org/wiki/Harold_and_Maude">Harold and Maude(1971)</a></cite></footer></blockquote>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/07/market-research/">Market Research, Wireframing and Desgin</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-15T15:04:00+08:00" pubdate data-updated="true">Jul 15<span>th</span>, 2013</time>
        
         | <a href="/2013/07/market-research/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><ul id="markdown-toc">
  <li><a href="#table-of-contents">Table Of Contents</a>    <ul>
      <li><a href="#section"><strong>点子，执行力和市场</strong></a>        <ul>
          <li><a href="#section-1"><strong>点子</strong></a></li>
          <li><a href="#section-2"><strong>执行力</strong></a></li>
          <li><a href="#section-3"><strong>市场</strong></a></li>
          <li><a href="#section-4"><strong>那么究竟什么是最重要的：产品/点子，执行力/团队，还是市场?</strong></a></li>
          <li><a href="#section-5"><strong>点子迷宫</strong></a></li>
          <li><a href="#section-6"><strong>执行力</strong></a></li>
        </ul>
      </li>
      <li><a href="#section-7"><strong>你的目标市场</strong></a>        <ul>
          <li><a href="#vs-"><strong>创业公司 vs. 小型企业</strong></a></li>
          <li><a href="#section-8"><strong>创业公司必须清楚自己的成本和利润</strong></a></li>
          <li><a href="#section-9"><strong>创业公司必须清楚经济体的规模</strong></a></li>
        </ul>
      </li>
      <li><a href="#section-10"><strong>市场调查</strong></a>        <ul>
          <li><a href="#section-11"><strong>市场调查工具</strong></a></li>
          <li><a href="#section-12"><strong>如何确定产品层次</strong></a></li>
        </ul>
      </li>
      <li><a href="#wireframecopywritingdesign"><strong>Wireframe，Copywriting和Design</strong></a>        <ul>
          <li><a href="#wireframe"><strong>Wireframe</strong></a></li>
          <li><a href="#copywriting"><strong>Copywriting</strong></a></li>
          <li><a href="#design"><strong>Design</strong></a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="table-of-contents">Table Of Contents</h2>

<h4 id="section"><strong>点子，执行力和市场</strong></h4>

<p>Quora上有一个著名的<a href="http://www.quora.com/Startup-Advice-and-Strategy/As-first-time-entrepreneurs-what-part-of-the-process-are-people-often-completely-blind-to/answer/Mike-Sellers">问答</a>，Mike Sellers的答案里面有一部分在江湖上流传很广：</p>

<blockquote><p>An idea is not a mockup<br />A mockup is not a prototype <br />A prototype is not a program <br />A program is not a product <br />A product is not a business <br />And a business is not profits</p></blockquote>

<p>这里描述了一个从点子到产品到盈利的状态机，在每个阶段，都有很多人失败了，无法进入下一个阶段。失败的原因，主要是因为面对的系统足够复杂时，可能会有不可预见的各种<a href="http://www.maa.org/devlin/devlin_05_03.html">缺陷</a>。特别是对我们搞技术的而言，虽然可能走完Program这个阶段，但是后面的三个阶段才是真正考验的开始。</p>

<table>
  <thead>
    <tr>
      <th>阶段</th>
      <th>完成的条件</th>
      <th>完成需要的最短时间</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Idea</td>
      <td>有一个赚钱的点子</td>
      <td>1分钟</td>
    </tr>
    <tr>
      <td>Mockup</td>
      <td>所有流程的Wireframe</td>
      <td>1天+</td>
    </tr>
    <tr>
      <td>Prototype</td>
      <td>跑通最关键流程的一个丑陋的实现</td>
      <td>1周+</td>
    </tr>
    <tr>
      <td>Program</td>
      <td>有测试并覆盖了所有流程的完整实现</td>
      <td>2-4周+</td>
    </tr>
    <tr>
      <td>Product</td>
      <td>工业设计，专利，定价，生产等</td>
      <td>3-6月+</td>
    </tr>
    <tr>
      <td>Business</td>
      <td>注册，监管机构备案，工资公司准备金等</td>
      <td>6-12月+</td>
    </tr>
    <tr>
      <td>Profits</td>
      <td>以超过成本的价格售出产品</td>
      <td>1年-正无穷</td>
    </tr>
  </tbody>
</table>

<p>从完成各个stage需要的时间可以看出，成功的企业都不是只有一个好点子：在状态机的前端，一定是一大堆好的点子。这些点子中的致命缺陷一定要在下面的某个stage才会暴露出来，但足够多的点子是基础。建议有一个专门的地方，<code>Google Docs</code> 也好， <code>OmniFocus</code> 也好，就是个简单的txt也好，保存和整理自己的点子，并且记录这些点子被推动到哪个阶段了。</p>

<h5 id="section-1"><strong>点子</strong></h5>

<p>一说到开自己的公司，最重要的似乎就是一个好的点子。这就是为什么很多人觉得自己和扎克伯格之间就差一个点子而已<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>；也是为什么那么多完全不生产产品的<a href="http://www.npr.org/blogs/money/2013/06/07/188370495/when-patents-attack-part-two">知识产权风投公司</a>靠着专利费<a href="http://www.plainsite.org/articles/article.html?id=2">活得好好</a>的。换句话来说，在很多人看来，只要有了好点子，如何实现并且推向市场就只是一些细节的问题了。</p>

<h5 id="section-2"><strong>执行力</strong></h5>

<p><a href="http://www.wired.com/wired/archive//6.11/metcalfe_pr.html">Bob Metcalfe</a>，以太网的发明者，3Com的创始人却有另一种认识：</p>

<blockquote><p>Metcalfe says his proudest accomplishment at the company was as head of sales and marketing. He claims credit for bringing revenue from zero to more than $1 million a month by 1984. And he&#8217;s careful to point out that it was this aptitude - not his skill as an inventor - that earned him his fortune.</p><p>&#8220;Flocks of MIT engineers come over here,&#8221; Metcalfe tells me, leading me up the back staircase at Beacon Street. &#8220;I love them, so I invite them. They look at this and say, &#8216;Wow! What a great house! I want to invent something like Ethernet.&#8221;&#8217; The walls of the narrow stairway are lined with photos and framed documents, like the first stock certificate issued at 3Com, four Ethernet patents, a photo of Metcalfe and Boggs, and articles Metcalfe has written for The New York Times and The Wall Street Journal.</p><p>&#8220;I have to sit&#8217;em down for an hour and say, &#8216;No, I don&#8217;t have this house because I invented Ethernet. I have this house because I went to Cleveland and Schenectady and places like that. I sold Ethernet for a decade. That&#8217;s why I have this house. It had nothing to do with that brainstorm in 1973.&#8221;&#8217;</p></blockquote>

<p>从一定程度上这种认识反应了另一种普遍的观点： <strong>执行力，而不是点子，才是创业的关键</strong> 。这种在Hacker News上被<a href="https://www.google.com.hk/search?q=site%3Anews.ycombinator.com+idea+not+execution&amp;qscrl=1">一而再再而三的提及</a>的观点确实是有道理的：冒出一个“创建社交网络”的点子很简单，但是要把它涉及的各种细节，大到是采用<a href="https://www.facebook.com/">对称</a>还是<a href="https://twitter.com/">非对称</a>的社交网络小到“Poke”应该怎么实现，考虑清楚，就不那么容易了。而即使考虑清楚上线后用户也很多，怎么把流行转化成盈利就更加艰难了：看看Second Life或者Digg的下场多么凄惨。</p>

<p>所以如果你开始创业，不妨提醒一下自己：点子或者甚至是专利并没必要放在那么至高无上的位置，能work的prototype要重要得多。可能在你游说投资者的时候，专利显得你的技术比较有门槛有防御性。但是一方面，如果你的东西被别人听到或者看过就能很容易的复制，可能也确实说明了产品的技术门槛比较低。另一方面，“我有一个创建养宠物的人的社交网络的点子”和“我开发了一个可以让养宠物的人快速找到信赖的兽医的系统“相比，后者对投资人的说服力要大多了。</p>

<p>因此创业的时候，你的点子可以大方的拿出来和周围的人讨论，他们会给你一些你意想不到的角度的意见。当然，有一种讨论是例外的，那就是在类似<a href="https://news.ycombinator.com/item?id=3639175">Hacker News</a>这样的创业社区里面。除非你的开发已经到了适合曝光原型的阶段，一般来说最好不要太早曝光你在做的事情。</p>

<p>这也是另一个对创业者来说执行力比点子更重要的原因：一旦你的点子被市场证明是可行的，就会有模仿者。不管多么伟大的社会，一旦一种商业模式被验证，就会有人开始跟进：这是因为找到一个solution比<a href="http://en.wikipedia.org/wiki/Primality_test">验证一个solution</a>难多了。所有跟进的人在抄袭你的核心功能时，都会加上他们自己独特的改进，这个竞争的过程中你必须有很强的执行力才能保持领先并脱颖而出。从Google战胜AltaVista，Facebook战胜Myspace和Friendster的过程都验证了这点。这也是为什么保持专注，不断努力的实现<a href="http://www.ashmaurya.com/2009/11/achievingproductmarketfit/">product-market fit</a>而不要惊动竞争对手显得特别关键的原因。</p>

<h5 id="section-3"><strong>市场</strong></h5>

<p>除开前面两个观点之外，还有一种观点。站在投资者角度，可以把”点子”对应到”产品”，把”执行力”对应到”团队”。也就是说，一个足够好的团队是可以推动各种执行层面的细节（财务上的，商务上的，技术上的，法律上的），把一个好的点子落实成一个产品的。但是这些仍然不是全部。用<a href="http://pmarchive.com/guide_to_startups_part4.html">Marc Andreessen</a>的话来说：</p>

<blockquote><p>Personally, I’ll take the third position – I’ll assert that market is the most impor- tant factor in a startup’s success or failure.</p><p>Why?</p><p>In a great market – a market with lots of real potential customers – the market pulls product out of the startup. The market needs to be fulfilled and the market will be fulfilled, by the first viable product that comes along. The product doesn’t need to be great; it just has to basically work. And, the market doesn’t care how good the team is, as long as the team can produce that viable product.</p></blockquote>

<h5 id="section-4"><strong>那么究竟什么是最重要的：产品/点子，执行力/团队，还是市场?</strong></h5>

<p>任何有一点儿<a href="http://cs229.stanford.edu/materials.html">机器学习</a>知识的人都能明白这三者是没有绝对的优先顺序的：它们都是关键因子，我们需要挨个解决。首先，我们要解决的问题是如何找到一个好点子？</p>

<h5 id="section-5"><strong>点子迷宫</strong></h5>

<p>一个好的创始人不应该只是有个好点子，他/她应该具备鸟瞰“点子迷宫”的能力。把解决一个需求的各种点子想象成迷宫里面的各条道路，作为消费者很可能只看到了拿出了产品的公司走的那条路。而作为好的创始人需要了解其他的公司是死在什么样的路上以及它们遇到了什么样的无法解决的问题。下图就是一个迷宫的例子：</p>

<p><img src="/downloads/images/example_of_idea_maze.png" alt="example of idea maze" title="Don't touch me..." /></p>

<p>有时候你不经过前一个迷宫有所积累，就没法到达下一个迷宫并走出去（比如Google是在search上有所收获之后，在<a href="http://googlepress.blogspot.com/2004/04/google-gets-message-launches-gmail.html">eamil</a>上也开始有了建树）。有时候迷宫自己也会随着时间变化（比如<a href="http://readwrite.com/2012/09/24/pandora-internet-radio-fairness-act#awesm=~obLCTtNRcPEnuA">Pandora的iPhone版本</a>）。有时候别的公司无法解决的问题被其他一些公司解决了（<a href="http://www.gartner.com/id%3D334368">Webvan失败了</a>，但是<a href="http://fresh.amazon.com/welcome;jsessionid=555BD9DF6EBBE824BCB76464FB768B3C">Amazon</a>、<a href="http://delivery.walmart.com/usd-estore/index.jsp?referrer=cookiesDetecting">Walmart</a>和<a href="http://shop.safeway.com/ecom/home">Safeway</a>成功的建立了送鲜货的物流）。有的时候解决前面的公司遇到的问题就形成了新公司进入迷宫时手里最有利的武器（比如Google的Pagerank灵感正是来源于Alta Vista在<a href="http://home.web.cern.ch/about/birth-web">1991年</a>还不那么明显的<a href="https://news.ycombinator.com/item?id=3925089">问题</a>）。</p>

<p>就像其他迷宫一样，大多数人都能找到创业迷宫的入口，但是能看到整个局面的人就不那么多了。拿前面图里面的例子来说，一个平庸的创始人可能就看到了”电影音乐分享”或者是”照片分享”的迷宫的入口，但是却看不清这个产业的历史，竞争对手的状况，<a href="http://www.barrysookman.com/2010/05/13/blogged-what-do-limewire-napster-kazaa-and-isohunt-all-have-in-common/">失败的例子</a>和能够让自己脱颖而出的技术。</p>

<p>因此，好的创始人要有能力鸟瞰整个迷宫，了解所有可能的路径和可能的问题。如果你能够使用示例中图表的形式详细的描述整个问题域，分析各种决策树上的各个分支，解释为什么你的计划能够顺利通过迷宫到达出口而不会遇到前面20个公司遇到的这样那样的问题，你可能就真的有一个不错的点子了。这就是为什么了解行业历史和做足够市场调查是那么重要。</p>

<h5 id="section-6"><strong>执行力</strong></h5>

<p>有了好的点子之后，如何建立执行力？其实简单来说，执行力无非是把todo list上的下一个东西做了。这是一个说起来很容易，但做起来非常有难度的事情：你要学会对其他人说不，你要学会对干扰说不，聚精会神地完成你的任务。</p>

<p>在各种保持专注力的方法论中，最好的是Thiel的 <a href="http://blog.idonethis.com/post/37113345206/peter-thiels-unorthodox-management-philosophy-of">One thing</a> ：组织里面每个人在任何时间都应该不仅知道自己首要的任务是什么，同时也要明白别人手里首要任务是什么。Marc Andreessen的 <a href="http://blog.idonethis.com/post/34170232603/marc-andreessens-productivity-trick-to-feeling">anti-todo list</a> 也<a href="http://lencie.cn/blog/2013/03/15/use-done-list-rather-than-todo-list/">值得一试</a>。</p>

<h4 id="section-7"><strong>你的目标市场</strong></h4>

<h5 id="vs-"><strong>创业公司 vs. 小型企业</strong></h5>

<p>清楚创业公司和小企业之间的<a href="http://www.kauffman.org/uploadedFiles/DownLoadableResources/a-tale-of-two-entrepreneurs.pdf">区别</a>是非常重要的。一个创业公司关注的是增长：如何引领行业，如何从小做大，如何创造丰厚的利润。Google，Facebook，Square，AirBnB等，这些公司都是标志性的创业公司。相比而言，小企业的目标可能不是那么宏伟：它们建立的基础多半是在一定地域内的某个行业有一些特别的优势，比如咖啡店，洗衣店等。</p>

<p>这也是为什么创业公司常常出现在互联网领域：这个领域的很多资源是虚拟化的，而虚拟化的资源从1扩展到1亿可比实体的资源要容易多了。比较一下37Signals的扩张和麦当劳星巴克的扩张你就会发现很多不同之处。</p>

<p>另一个明显的区别是小企业一般在很短的时间内就必须开始盈利。否则，会在很短时间内因为止损而关门大吉。创业公司则不同：可能会有很长一段时间是亏损的状态，直到顺利翻盘或者是倒闭。</p>

<p>另外创业公司需要锻炼的就是和资本打交道的能力。VC的钱既可能造成<a href="http://mystartuphas30daystolive.tumblr.com/">严重的问题</a>，也可能让创业公司一飞冲天。做出决定的最核心的考量在于你的野心和你承受失败的能力：如果你不能承受从0开始，那就不要希望做到很大（<a href="http://diffle-history.blogspot.com/">1</a>,<a href="http://www.paulgraham.com/startupmistakes.html">2</a>,<a href="http://www.businessinsider.com/33-startups-that-died-reveal-why-they-failed-2013-6?op=1">3</a>）。</p>

<h5 id="section-8"><strong>创业公司必须清楚自己的成本和利润</strong></h5>

<p>如果你是有一飞冲天的雄心也准备好了迎接失败，那么投身到一个行业之前，也要先调查清楚你的产品是不是能够承载你的梦想。</p>

<p>我们都知道产品的成本会随着产量的增大变低。假设产量、成本和利润的关系如下表所示：</p>

<table>
  <thead>
    <tr>
      <th>产品产量</th>
      <th>单位产品成本</th>
      <th>单位产品利润</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0&lt;=n&lt;=00</td>
      <td>1200</td>
      <td>1000</td>
    </tr>
    <tr>
      <td>101&lt;=n&lt;=1000</td>
      <td>975</td>
      <td>1000</td>
    </tr>
    <tr>
      <td>1001&lt;=n</td>
      <td>700</td>
      <td>1000</td>
    </tr>
  </tbody>
</table>

<p>凭着这张表你就可以筹到大约 <code>$50000</code> 启动资金来完成最初的100个订单，然后准备 <code>$24,7500</code> 用于后续的1000个订单的完成。经过这两个阶段性胜利之后，你大概才仅仅把成本捞回来而已。</p>

<p>这些简单的计算告诉我们：首先，降成本是非常关键的，比如通过使用软件把单位产品的成本变成固定的成本。其次，把整个事情做起来需要的资本是要提前计算的，这也是VC们需要的数据之一。最后，定价也是需要技巧的。由于一开始没有竞争，你可以定一个相对高的价格来赚取足够的成本。而且，<a href="http://innovatobase.wordpress.com/2013/03/04/loyal-customers-vs-groupon-csutomers/">研究证明</a>免费或者是以极低折扣拿到产品的用户是没有忠诚度的。那些给钱的用户会认为自己也参与了产品的过程（比如提出建议等）。</p>

<h5 id="section-9"><strong>创业公司必须清楚经济体的规模</strong></h5>

<p>当有了一个从数据上看起来不错的产品之后，你还要研究所处的市场是什么样一个规模。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">市场规模 <span class="o">=</span> 年均消费总数 x 产品平均价格
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>很明显，你如果梦想拥有年销售额10亿的事业，这个市场要不就是产品价格很高，要不就是消费总数很大。下面的一些例子说明了10亿的事业可以如何被构建出来：</p>

<ul>
  <li>均价$1，总数超过10亿: Coca Cola</li>
  <li>均价$10，总数超过1亿: Johnson and Johnson </li>
  <li>均价$100，总数超过千万: Blizzard</li>
  <li>均价$1000，总数超过百万: Lenovo</li>
  <li>均价$10,000，总数超过十万: Toyota</li>
  <li>均价$100,000，总数超过一万: Oracle</li>
  <li>均价$1,000,000，总数超过1,000: Countrywide</li>
</ul>

<p>当然，现在全球化程度高，很多市场是超过了10亿的，比如汽车。每年汽车市场大概是<a href="https://en.wikipedia.org/wiki/Automotive_industry#World_motor_vehicle_production">1亿的产量</a>，均价大概是$10000。这就是为什么Google花大价钱研究<a href="http://www.forbes.com/sites/chunkamui/2013/01/22/fasten-your-seatbelts-googles-driverless-car-is-worth-trillions/">无人驾驶车</a>背后的商业考虑：这是个比搜索潜力要大很多的市场。</p>

<p>另外需要注意的是均价低的产品需要自动化程度极高的生产和稳定的质量才会有利润。如果你$1的可乐经常被消费者投诉你是没有办法做下去的。相对的，低价的产品对销售的需求也降低了：你不需要售楼小姐那样巧舌如簧的队伍也能把可乐卖出去，不是吗？</p>

<h4 id="section-10"><strong>市场调查</strong></h4>

<p>在了解了市场调查的重要性之后，我们究竟如何能够掌握一个市场的规模以及相应的我们的产品需要多少财力人力的投入呢？</p>

<h5 id="section-11"><strong>市场调查工具</strong></h5>

<p>假设你现在对一个市场有了兴趣。比如，你相信新闻里面说的<a href="http://www.scmp.com/business/money/markets-investing/article/1076500/yuan-hailed-world-reserve-currency">人民币</a>最终会取代美元成为<a href="http://online.wsj.com/article/SB10001424052702303561504577496233362694486.html">世界通用币</a>。于是你想做一个服务让人们可以方便的把USD换成RMB。你如何验证你的构想是否成立？</p>

<ol>
  <li>首先，你要从媒体的报道里面抓取信息，形成一个总体框架。除开媒体，Google Books，美国的<a href="http://www.sec.gov/edgar.shtml">SEC flings</a>和维基百科都会非常有用。</li>
  <li>然后，你要学会从Google的商业数据搜索引擎里能拿到的数据中，算出一个市场规模。</li>
  <li>熟悉Google的<a href="https://adwords.google.com/um/Signup/Home">Keyword Planner</a>和Facebook的<a href="https://www.facebook.com/ads/create/">Advertiser Tools</a>。</li>
  <li>如果前面的研究表明这个市场的确是可以预期的，你可以创建一个类似<a href="http://launchrock.co/">Launchrock</a>的首页，做一些基本的<a href="http://moz.com/beginners-guide-to-seo">SEO</a>。如果你真的要理清并向别人展示你的想法，你可以还需要画一些wireframe。</li>
  <li>最后，你可以去Google的<a href="https://adwords.google.com/um/Signup/Home">Adwords</a>或者是Facebook <a href="https://www.facebook.com/advertising">Ads</a>上投放一些广告看看可能的效果。</li>
</ol>

<p>这些步骤主要的目的就是，在你开始投入时间和金钱进行所谓的MVP(<a href="http://en.wikipedia.org/wiki/Minimum_viable_product">Minimum Viable Product</a>)开发之前，需要验证市场的存在性。了解市场这件事情要从数据入手，也是一个重要原则。就像福特说的一样，如果他只是去问每个消费者他们想要什么，可能他们的回答会是：一匹更快的马。</p>

<h5 id="section-12"><strong>如何确定产品层次</strong></h5>

<p>在你有了点子，也调查清楚了市场，如果进行你产品的市场定位？首先可以读读Kickstarter的<a href="http://blog.boundforanything.com/2012/02/how-to-set-tiers-on-kickstarter/">product tiers</a>和<a href="http://www.kickstarter.com/blog/trends-in-pricing-and-duration">trends</a>。</p>

<p>这里的思路是，假设你的市场调查面向的市场是一个70亿人的全球市场。那么你的市场调查的表格每一行代表一个人，N列代表一个个他们的属性（地域、职业等），K列代表产品的属性（产品的版本等）。通过<a href="http://www.google.com/insights/consumersurveys/home">Google Consumer Research Surveys</a>或者是<a href="http://answers.onstartups.com/questions/44163/lean-startup-landing-page-test-how-do-i-measure-success">Launchrock landing</a> pages这样的产品，你可以从受访人群中取样得到自己的产品要如何设计。</p>

<p>当然，如果你是认真的要开始一个startup，付费给专业的机构进行市场调查可能比使用这些产品对你来说性价比更高。</p>

<h4 id="wireframecopywritingdesign"><strong>Wireframe，Copywriting和Design</strong></h4>

<p>一旦确定了要动手，你就得首先设计你的产品网站的mockup，也就是所谓的wireframe。</p>

<h5 id="wireframe"><strong>Wireframe</strong></h5>

<p>优秀的Wireframe工具很多，特别是下面几个：</p>

<ul>
  <li><a href="http://www.omnigroup.com/products/omnigraffle/">Omnigraffle Pro</a>特别适合专业UX</li>
  <li><a href="https://www.lucidchart.com/google_drive/prompt">Lucidchart</a>对团队合作支持很好</li>
  <li><a href="https://jetstrap.com/">Jetstrap</a>可以把最终的设计转成Twitter Bootstrap</li>
  <li><a href="http://thenextweb.com/apps/2012/11/17/pop-this-iphone-app-is-every-designers-missing-puzzle-piece-for-prototyping-on-paper/">POP</a>可以方便的导入手绘的流程图</li>
</ul>

<p>熟练掌握上面的一两个就足够了，Wireframe的目的是为了得到一个全站的<a href="http://wireframes.linowski.ca/2009/12/omnigraffle-wireflows/">架构和流程示意</a>。</p>

<h5 id="copywriting"><strong>Copywriting</strong></h5>

<p>筑造品牌形象的一些原则：</p>

<ul>
  <li>通过主页表达：你的核心竞争力和品牌价值必须要在主页里面体现。不要指望用户会点到其他页面。</li>
  <li>通过媒体发布：Amazon在进入产品阶段之前就<a href="http://aws.amazon.com/about-aws/whats-new/">先发媒体稿</a>。通过搜集反馈，很快就能知道究竟什么是用户期待的新功能，什么是自己制造的噪声。</li>
  <li>研究对手扬长避短：我们在进行技术选型时常常<a href="http://en.wikipedia.org/wiki/Comparison_of_relational_database_management_systems#Fundamental_features">这么做</a>。了解你的竞争对手的缺陷和你的优势，会让你明白究竟什么是你脱颖而出的关键。</li>
  <li>数据说话，案例说话：没有什么比市场里面的数据和成功案例更有说服力。</li>
</ul>

<h5 id="design"><strong>Design</strong></h5>

<p>设计的一些原则：</p>

<ul>
  <li><strong>Vector和Raster图片</strong> ：首先你要明白<a href="http://en.wikipedia.org/wiki/Vector_graphics">vector</a>和<a href="http://en.wikipedia.org/wiki/Raster_graphics">raster</a>的区别。如果可能的话，尽量使用vector，特别是在早期MVP阶段。</li>
  <li><strong>对齐，对比度等</strong>：Robin Williams的《<a href="http://www.amazon.com/The-Non-Designers-Design-Book-Typographic/dp/1566091594">Non-Designer’s Desgin Book</a>》值得一读。特别是其中提到的<a href="http://www.nurelm.com/themanual/2009/07/07/designing-for-the-non-designer-part-i-the-basics/">4个基本原则</a>：<a href="http://www.vanseodesign.com/web-design/design-basics-alignment/">Alignment</a>，<a href="http://www.vanseodesign.com/web-design/design-basics-repetition/">Repetition</a>，<a href="http://www.vanseodesign.com/web-design/design-basics-contrast/">Contrast</a>，<a href="http://www.vanseodesign.com/web-design/design-basics-proximity-to-know-what-belongs-with-what/">Proximity</a>。</li>
  <li><strong>字体和图标</strong> ：尽量使用字体来表达设计。因为字体是矢量图，并且在所有的浏览器里面都可以用 <code>CSS</code>
进行控制和调整。现在还非常集成了矢量的图标的字体库，比如<a href="http://fortawesome.github.io/Font-Awesome/">FontAwesome</a>。 </li>
  <li><strong>视频，动画</strong>：宁缺毋滥。一定要精心制作，能给客户留下深刻印象同时又深入解析了产品的特性的。</li>
  <li><strong>使用Bootstrap，Themeforest，99Designs，Dribble</strong>：当把wireframe变成网页时，不要重新造轮子。Bootstrap是一个免费的框架，和前面提到的Jetstrap合用很有威力。<a href="http://themeforest.net/">Themeforest</a>上的服务要贵一些，一般是$9到$12的模板。而<a href="http://99designs.com/">99Designs</a>这样的专业设计所要大概几百到几千刀。<a href="http://dribbble.com/">Dribble</a>是需找合适Designer的很好的地方。</li>
</ul>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>事实上Facebook的系统之大，后台涉及的技术是非常复杂的：<a href="https://www.facebook.com/notes/facebook-engineering/tao-the-power-of-the-graph/10151525983993920">1</a>，<a href="https://www.facebook.com/note.php?note_id=76191543919">2</a>，<a href="https://www.facebook.com/notes/facebook-engineering/under-the-hood-indexing-and-ranking-in-graph-search/10151361720763920">3</a>。即便是它看起来不那么复杂的前端，也不是你有一个点子就能做好的：你的用户可是几十亿形形色色的人。<a href="#fnref:1" rel="reference">&#8617;</a></p>
    </li>
  </ol>
</div>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/11/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/9/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    
  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
Blog theme: <a href="https://github.com/lenciel/octopress-theme-lenciel">Octopress-Lenciel 0.1</a>
<span class="theme-version">Copyright &copy; 2014 - Lenciel Li</span>
  <section class="contruction-wrap">
    <div class="contruction"></div>
  </section>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'lencielgithub';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>









<!--














                                            IIIIIIIIII       I
                  II                     IIIIIIIIIIIIIIIIIIII
                  IIII                  IIIIIIIIIIIIIIIIIIII
                  IIIIII                IIIIIIIIIIIIIIIIII III
                  IIIIIIII             IIIIIIIIIIIIIIIIIIIIII
                  IIIIIIIIIII          IIIIIIIIIIIIIIIIIIIII
                  IIIIIIIIIIIIII       IIIIIIIIIIIIIIIIIII
                   IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                  I  IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                  IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                  IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                   IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                    IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                     IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                         IIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                     IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                      IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                        IIIIIIIIIIIIIIIIIIIIIIIIIIIII
                           IIIIIIIIIIIIIIIIIIIIIIIII
                             IIIIIIIIIIIIIIIIIIIII
                          IIIIIIIIIIIIIIIIIIIIIII
                I   IIIIIIIIIIIIIIIIIIIIIIIIII
                  IIIIIIIIIIIIIIIIIIIIIIIIII
                      IIIIIIIIIIIIIIIIII















 -->


</body>
</html>
