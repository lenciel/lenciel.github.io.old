
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>@Lenciel</title>
  <meta name="author" content="Lenciel Li">

  
  <meta name="description" content="每年高考的时候，本座都特别期待江苏的作文题。因为传说中江苏的语文老师每年聚在一起都不骂国足是猪，而是骂作文命题老师是猪：对国足，他们还总是能猜中结果，而作文题，他们边都摸不着。 这次就果然又很特立独行的一猪哇：品味时尚。 该作文题还有立意的提示信息： 人们追逐时尚，不是因为它适合自己的气质， &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://lenciel.cn/blog/page/11/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/github/lenciel" rel="alternate" title="@Lenciel" type="application/atom+xml">
  <!-- Facebook Open Graph
     Facebook Debugger: https://developers.facebook.com/tools/debug -->

<meta property="og:type" content="article" />
<meta property="og:url" content="http://lenciel.cn/blog/page/11/" />
<meta property="og:description" content="每年高考的时候，本座都特别期待江苏的作文题。因为传说中江苏的语文老师每年聚在一起都不骂国足是猪，而是骂作文命题老师是猪：对国足，他们还总是能猜中结果，而作文题，他们边都摸不着。 这次就果然又很特立独行的一猪哇：品味时尚。 该作文题还有立意的提示信息： 人们追逐时尚，不是因为它适合自己的气质， &hellip;" />

<meta property="og:site_name" content="http://lenciel.cn" />
<meta property="article:author" content="https://plus.google.com/114787528537231301324">



<meta itemprop="description" content="每年高考的时候，本座都特别期待江苏的作文题。因为传说中江苏的语文老师每年聚在一起都不骂国足是猪，而是骂作文命题老师是猪：对国足，他们还总是能猜中结果，而作文题，他们边都摸不着。 这次就果然又很特立独行的一猪哇：品味时尚。 该作文题还有立意的提示信息： 人们追逐时尚，不是因为它适合自己的气质， &hellip;" />

<!-- Combine multiple fonts into one request -->
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic|Patua+One|Yanone+Kaffeesatz" rel="stylesheet" type="text/css">
<!-- jQuery -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>

  <script>
  !function(g,s,q,r,d){r=g[r]=g[r]||function(){(r.q=r.q||[]).push(
  arguments)};d=s.createElement(q);q=s.getElementsByTagName(q)[0];
  d.src='//d1l6p2sc9645hc.cloudfront.net/tracker.js';q.parentNode.
  insertBefore(d,q)}(window,document,'script','_gs');

  _gs('GSN-360316-J');
</script>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-175991-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">@Lenciel</a></h1>
  
    <h2>Thoughts and Rants.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/github/lenciel" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:lenciel.cn" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/"><i class="icon-home"></i>Home</a></li>
  <li><a href="/blog/archives"><i class="icon-book-alt"></i>Archives</a><span class="divider"></span></li>
  <li><a href="/about"><i class="icon-user"></i>About</a><span class="divider"></span></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/06/kill-yourself-in-a-fashion-way/">品味时尚</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-06-09T21:25:00+08:00" pubdate data-updated="true">Jun 9<span>th</span>, 2009</time>
        
         | <a href="/2009/06/kill-yourself-in-a-fashion-way/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img title="fashion" style="border-right: 0px; border-top: 0px; display: inline; border-left: 0px; border-bottom: 0px" height="324" alt="fashion" src="/downloads/images/fashion.jpg" width="484" border="0" /></p>

<p>每年高考的时候，本座都特别期待江苏的作文题。因为传说中江苏的语文老师每年聚在一起都不骂国足是猪，而是骂作文命题老师是猪：对国足，他们还总是能猜中结果，而作文题，他们边都摸不着。</p>

<p>这次就果然又很特立独行的一猪哇：<a href="http://edu.qq.com/a/20090608/000172.htm" target="_blank">品味时尚</a>。</p>

<p>该作文题还有立意的提示信息：</p>

<blockquote>
  <p>人们追逐时尚，不是因为它适合自己的气质，而只是因为大家都是如此。</p>
</blockquote>

<p>不知道这个老师是不是个反非主流斗士，出了这么个题目：说实话，现在的小孩子走出来，没有比非主流更主流的打扮了。</p>

<p>于是同学们为了中举，都会忽悠老师说，时尚应该是自信，又或者是绿色，又或者是环保，又或者是本真，于是就显得自己人生观世界观狂成熟狂完满，即使行走在物欲横流的今天，也能百毒不侵了。</p>

<p>只是无论如何，我们总还是有条件不好的孩子。他也许读书就是为了扔掉锄头，能让自己的家族到城市里，过体面的生活，却只好写，“我虽然无法上网，甚至看不到电视。除开读书，还要帮家里干农活，但是我觉得时尚其实是本真。我现在的生活就挺好的，那些人人都追求的东西，房子，金钱，并不适合我的气质”。</p>

<p>不知道这种话，如果叫命题老师自己去写，他会不会边写边吐。</p>

<p>其实，对本座来说，最近正好有一个有趣的新闻，非常的“时尚”。</p>

<p>大家都知道，《Kill Bill》里面的Bill，最近挂了：是真的把自己挂起来了。不过，如果你用不同的关键字去搜索，会得出蛮有趣的结果。</p>

<blockquote>
  <p>心地纯良如偶像派的时尚品味者：<a href="http://www.google.com/search?hl=en&amp;q=kill+bill+%E4%B8%BB%E8%A7%92+%E8%87%AA%E6%9D%80&amp;sourceid=navclient-ff&amp;rlz=1B3GGGL_zh-CN___CN231&amp;ie=UTF-8" target="_blank">click</a></p>

  <p>心地不纯良如本座的时尚品味者：<a href="http://www.google.com/search?hl=en&amp;q=kill+bill+%E4%B8%BB%E8%A7%92+%E8%87%AA%E6%85%B0&amp;sourceid=navclient-ff&amp;rlz=1B3GGGL_zh-CN___CN231&amp;ie=UTF-8" target="_blank">click</a></p>
</blockquote>

<p>嗯哼……其实大家不要觉得从事“手工业”的时候出事有什么奇怪的。本座在以前看<a href="http://en.wikipedia.org/wiki/Chuck_Palahniuk" target="_blank">Chuck</a>大叔<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup> 那篇著名的<a href="http://chuckpalahniuk.net/features/shorts/guts" target="_blank">Guts</a>的时候（已经有人<a href="http://www.verycd.com/groups/@g2386100/683454.topic" target="_blank">翻译</a>，慎入！！）有读到过一段：</p>

<blockquote>
  <p>Looking back, kid-psych experts, school counselors now say that most of the last peak in teen suicide was kids trying to choke while they beat off. Their folks would find them, a towel twisted around the kid’s neck, the towel tied to the rod in their bedroom closet, the kid dead. Dead sperm everywhere. Of course the folks cleaned up. They put some pants on their kid. They made it look… better. Intentional at least. The regular kind of sad, teen suicide.</p>
</blockquote>

<p>嗯哼……所以有的时候时尚人士莫名其妙的自缢，是没有那么悲情的。</p>

<p>这又让本座想起来，世界上有两种动物，因为特别重视配偶闻名。一种就是俺们国鸟丹顶鹤<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup> 。诗经说丫们谈起恋爱“鹤鸣九皋，声闻于天”。而且一方去世，另一方一定会孤单终老（要知道丹顶鹤可以活60岁左右）。</p>

<p>甚至有一种颇有争论的说法是，只要双方有一个意外死去，另外一个不久就会把自己的脖子打一个结，跟着死去。</p>

<p>每次本座看到人们这样的议论时，总是会有一些心地不纯良的时尚品味在心头默默的泛起<sup id="fnref:3"><a href="#fn:3" rel="footnote">3</a></sup> 。</p>

<p>可惜啊，老师，您看我肚子里面这么有货，却没法跟您一起品味时尚。</p>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>这位大叔不是写黄书的，写的第一篇长篇小说叫做，《<a href="http://www.imdb.com/title/tt0137523/" target="_blank">Fight Club</a>》。<a href="#fnref:1" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p>还有一种是鸳鸯么？   <a href="#fnref:2" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:3">
      <p>请问这样是不是比较隐晦一点…<a href="#fnref:3" rel="reference">&#8617;</a></p>
    </li>
  </ol>
</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/04/ssh-using-paramiko/">使用paramiko进行ssh工作</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-04-23T00:37:00+08:00" pubdate data-updated="true">Apr 23<span>rd</span>, 2009</time>
        
         | <a href="/2009/04/ssh-using-paramiko/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>最近在单位写一个自动build的小工具。因为clearcase的<code>setview</code>命令实际上是激活一个新的<code>shell</code>，所以用简单的“串通”<code>shell</code>的脚本很难做到。</p>

<p>因为在邮件组里面看到有同样问题的Matt说用<code>paramiko</code>解决了问题，就试了试，过程还颇有点艰辛。</p>

<p>首先，<code>paramiko</code>没有直接的<code>msi</code>或者<code>exe</code>版本给<code>Windows</code>用户下载，而是需要在本地进行编译。而且<code>python</code>的<code>easy_install</code>工具在Vista下面会报错，所以至少花了十几分钟才算安装完毕。</p>

<p>结果在用test.py验证安装的时候就报错了，说什么：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="n">paramiko</span><span class="o">.</span><span class="n">SSHException</span><span class="p">:</span> <span class="n">No</span> <span class="n">suitable</span> <span class="n">address</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>安装是我自己一步步弄得，难道搞错了？只好照着demo写了一个sftp的脚本，发现是可以跑的，干。</p>

<p>只好丢了封信给邮件组，然后自己开始找是啥问题。丢给邮件组的信至今没有回音（人气不行啊，<code>paramiko</code>），问题还是找到了。原来是1.7.5的<code>paramiko</code>增加了对ipv6的支持，结果引入了错误。更新了<code>client.py</code>后重新编译就可以用了。</p>

<p>最后，虽然demo的例子也挺多，但是好像没有说清楚怎么用invoke_shell和get_pty以及照例奉上一段代码。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span> (paramiko_sample.py)</span> <a href="/downloads/code/paramiko_sample.py">download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
<span class="line-number">79</span>
<span class="line-number">80</span>
<span class="line-number">81</span>
<span class="line-number">82</span>
<span class="line-number">83</span>
<span class="line-number">84</span>
<span class="line-number">85</span>
<span class="line-number">86</span>
<span class="line-number">87</span>
<span class="line-number">88</span>
<span class="line-number">89</span>
<span class="line-number">90</span>
<span class="line-number">91</span>
<span class="line-number">92</span>
<span class="line-number">93</span>
<span class="line-number">94</span>
<span class="line-number">95</span>
<span class="line-number">96</span>
<span class="line-number">97</span>
<span class="line-number">98</span>
<span class="line-number">99</span>
<span class="line-number">100</span>
<span class="line-number">101</span>
<span class="line-number">102</span>
<span class="line-number">103</span>
<span class="line-number">104</span>
<span class="line-number">105</span>
<span class="line-number">106</span>
<span class="line-number">107</span>
<span class="line-number">108</span>
<span class="line-number">109</span>
<span class="line-number">110</span>
<span class="line-number">111</span>
<span class="line-number">112</span>
<span class="line-number">113</span>
<span class="line-number">114</span>
<span class="line-number">115</span>
<span class="line-number">116</span>
<span class="line-number">117</span>
<span class="line-number">118</span>
<span class="line-number">119</span>
<span class="line-number">120</span>
<span class="line-number">121</span>
<span class="line-number">122</span>
<span class="line-number">123</span>
<span class="line-number">124</span>
<span class="line-number">125</span>
<span class="line-number">126</span>
<span class="line-number">127</span>
<span class="line-number">128</span>
<span class="line-number">129</span>
<span class="line-number">130</span>
<span class="line-number">131</span>
<span class="line-number">132</span>
<span class="line-number">133</span>
<span class="line-number">134</span>
<span class="line-number">135</span>
<span class="line-number">136</span>
<span class="line-number">137</span>
<span class="line-number">138</span>
<span class="line-number">139</span>
<span class="line-number">140</span>
<span class="line-number">141</span>
<span class="line-number">142</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="sd">&quot;&quot;&quot;</span>
</span><span class="line"><span class="sd">This script is using for build the software package</span>
</span><span class="line"><span class="sd">&quot;&quot;&quot;</span>
</span><span class="line">
</span><span class="line"><span class="kn">import</span> <span class="nn">sys</span>
</span><span class="line"><span class="kn">import</span> <span class="nn">time</span>
</span><span class="line"><span class="kn">import</span> <span class="nn">paramiko</span>
</span><span class="line"><span class="kn">import</span> <span class="nn">traceback</span>
</span><span class="line"><span class="kn">import</span> <span class="nn">ConfigParser</span>
</span><span class="line">
</span><span class="line"><span class="sd">&quot;&quot;&quot;</span>
</span><span class="line"><span class="sd">The main class of the builder.</span>
</span><span class="line"><span class="sd">&quot;&quot;&quot;</span>
</span><span class="line"><span class="k">class</span> <span class="nc">Builder</span><span class="p">:</span>
</span><span class="line">
</span><span class="line">    <span class="sd">&quot;&quot;&quot;Parses options from the ini file to create connection.&quot;&quot;&quot;</span>
</span><span class="line">    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">inifile</span><span class="p">):</span>
</span><span class="line">        <span class="k">try</span><span class="p">:</span>
</span><span class="line">            <span class="n">config</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
</span><span class="line">            <span class="n">config</span><span class="o">.</span><span class="n">readfp</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">inifile</span><span class="p">))</span>
</span><span class="line">
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span> <span class="o">=</span> <span class="n">paramiko</span><span class="o">.</span><span class="n">SSHClient</span><span class="p">()</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span><span class="o">.</span><span class="n">set_missing_host_key_policy</span><span class="p">(</span><span class="n">paramiko</span><span class="o">.</span><span class="n">AutoAddPolicy</span><span class="p">())</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;host&#39;</span><span class="p">,</span><span class="s">&#39;server&#39;</span><span class="p">),</span>
</span><span class="line">                              <span class="n">port</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="s">&#39;host&#39;</span><span class="p">,</span> <span class="s">&#39;port&#39;</span><span class="p">),</span>
</span><span class="line">                              <span class="n">username</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;host&#39;</span><span class="p">,</span><span class="s">&#39;user&#39;</span><span class="p">),</span>
</span><span class="line">                              <span class="n">password</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;host&#39;</span><span class="p">,</span><span class="s">&#39;password&#39;</span><span class="p">))</span>
</span><span class="line">
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_t</span> <span class="o">=</span> <span class="n">paramiko</span><span class="o">.</span><span class="n">Transport</span><span class="p">((</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;host&#39;</span><span class="p">,</span><span class="s">&#39;server&#39;</span><span class="p">),</span> <span class="n">config</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="s">&#39;host&#39;</span><span class="p">,</span> <span class="s">&#39;port&#39;</span><span class="p">)))</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_t</span><span class="o">.</span><span class="n">start_client</span><span class="p">()</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_t</span><span class="o">.</span><span class="n">auth_password</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;host&#39;</span><span class="p">,</span><span class="s">&#39;user&#39;</span><span class="p">),</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;host&#39;</span><span class="p">,</span><span class="s">&#39;password&#39;</span><span class="p">))</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_sftp</span> <span class="o">=</span> <span class="n">paramiko</span><span class="o">.</span><span class="n">SFTPClient</span><span class="o">.</span><span class="n">from_transport</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_t</span><span class="p">)</span>
</span><span class="line">        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
</span><span class="line">            <span class="k">print</span> <span class="s">&#39;*** Caught exception: </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">__class__</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span class="line">            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</span><span class="line">            <span class="k">try</span><span class="p">:</span>
</span><span class="line">                <span class="bp">self</span><span class="o">.</span><span class="n">closeConn</span><span class="p">()</span>
</span><span class="line">            <span class="k">except</span><span class="p">:</span>
</span><span class="line">                <span class="k">pass</span>
</span><span class="line">            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_fpga</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;fpga compress&#39;</span><span class="p">,</span><span class="s">&#39;fpga&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_lpath</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;fpga compress&#39;</span><span class="p">,</span><span class="s">&#39;local_fpga_path&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_rpath</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;fpga compress&#39;</span><span class="p">,</span><span class="s">&#39;remote_fpga_path&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_oab</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;fpga compress&#39;</span><span class="p">,</span><span class="s">&#39;oab&#39;</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_xlf</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;xlf build&#39;</span><span class="p">,</span><span class="s">&#39;xlf&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_lmid</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;xlf build&#39;</span><span class="p">,</span><span class="s">&#39;lmid&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_xpp</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;xlf build&#39;</span><span class="p">,</span><span class="s">&#39;xpp&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_xdp</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;xlf build&#39;</span><span class="p">,</span><span class="s">&#39;xdp&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_rru</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;xlf build&#39;</span><span class="p">,</span><span class="s">&#39;rru&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_rruswdb</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;xlf build&#39;</span><span class="p">,</span><span class="s">&#39;rru_sw_db&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_xpl</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;xlf build&#39;</span><span class="p">,</span><span class="s">&#39;xpl&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Your input fpga file is:&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_lpath</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_fpga</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
</span><span class="line">        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Your ouput xlf file will be:&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlf</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="sd">&quot;&quot;&quot;Run command on the server&quot;&quot;&quot;</span>
</span><span class="line">    <span class="k">def</span> <span class="nf">runCmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
</span><span class="line">        <span class="sd">&quot;&quot;&quot;run &lt;command&gt;</span>
</span><span class="line"><span class="sd">        Execute this command on all hosts in the list&quot;&quot;&quot;</span>
</span><span class="line">        <span class="k">if</span> <span class="n">command</span><span class="p">:</span>
</span><span class="line">            <span class="n">stdin</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span><span class="line">            <span class="n">stdin</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class="line">            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">stdout</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
</span><span class="line">                <span class="k">print</span> <span class="n">line</span>
</span><span class="line">        <span class="k">else</span><span class="p">:</span>
</span><span class="line">            <span class="k">print</span> <span class="s">&quot;usage: run &lt;command&gt;&quot;</span>
</span><span class="line">
</span><span class="line">    <span class="sd">&quot;&quot;&quot;Upload the fpga and compress it to oab.bin&quot;&quot;&quot;</span>
</span><span class="line">    <span class="k">def</span> <span class="nf">createOab</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_sftp</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lpath</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_fpga</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_rpath</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_fpga</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">runCmd</span><span class="p">(</span><span class="s">&quot;hou_create_fpga -bf </span><span class="se">\&quot;</span><span class="s">/home/ehholli/fpgainput/fpga.med</span><span class="se">\&quot;</span><span class="s"> -dn </span><span class="se">\&quot;</span><span class="s">CXC 172 8213/1</span><span class="se">\&quot;</span><span class="s"> -of oab -dev </span><span class="se">\&quot;</span><span class="s">XC2V6000,-4</span><span class="se">\&quot;</span><span class="s"> -dir /home/ehholli/fpgaoutput/&quot;</span><span class="p">)</span>
</span><span class="line">        <span class="k">try</span><span class="p">:</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_sftp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_oab</span><span class="p">,</span><span class="s">&#39;oab.bin&#39;</span><span class="p">)</span>
</span><span class="line">            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Fpga file compress successfully!&quot;</span><span class="p">)</span>
</span><span class="line">        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
</span><span class="line">            <span class="k">print</span> <span class="s">&#39;*** Caught exception: </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">__class__</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span class="line">            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</span><span class="line">            <span class="k">try</span><span class="p">:</span>
</span><span class="line">                <span class="bp">self</span><span class="o">.</span><span class="n">closeConn</span><span class="p">()</span>
</span><span class="line">            <span class="k">except</span><span class="p">:</span>
</span><span class="line">                <span class="k">pass</span>
</span><span class="line">            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="sd">&quot;&quot;&quot;Make the tlf&quot;&quot;&quot;</span>
</span><span class="line">    <span class="k">def</span> <span class="nf">genXlf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="c">#open a interactive shell</span>
</span><span class="line">        <span class="n">ct_chan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_t</span><span class="o">.</span><span class="n">open_session</span><span class="p">()</span>
</span><span class="line">        <span class="n">ct_chan</span><span class="o">.</span><span class="n">setblocking</span><span class="p">()</span>
</span><span class="line">        <span class="n">ct_chan</span><span class="o">.</span><span class="n">get_pty</span><span class="p">()</span>
</span><span class="line">        <span class="n">ct_chan</span><span class="o">.</span><span class="n">invoke_shell</span><span class="p">()</span>
</span><span class="line">        <span class="c">#ct setview ehholli</span>
</span><span class="line">        <span class="k">if</span><span class="p">(</span><span class="n">ct_chan</span><span class="o">.</span><span class="n">send_ready</span><span class="p">()):</span>
</span><span class="line">            <span class="n">ct_chan</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;ct setview ehholli</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">)</span>
</span><span class="line">        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">        <span class="c">#compile</span>
</span><span class="line">        <span class="n">build_cmd</span><span class="o">=</span><span class="s">&quot;/vobs/rbs/hw/bcp/xp/deliv/solaris2/bin/xlf_gen -r &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_xpp</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_xdp</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_rru</span> \
</span><span class="line">                     <span class="o">+</span><span class="s">&quot; -i &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_oab</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_rruswdb</span> \
</span><span class="line">                     <span class="o">+</span><span class="s">&quot; -o /home/ehholli/tmp/&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlf</span> \
</span><span class="line">                     <span class="o">+</span><span class="s">&quot; -x &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_xpl</span> \
</span><span class="line">                     <span class="o">+</span><span class="s">&quot; -lmid </span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_lmid</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\&quot;</span><span class="s">&quot;</span> \
</span><span class="line">                     <span class="o">+</span><span class="s">&quot; -t </span><span class="se">\&quot;</span><span class="s">au_applic</span><span class="se">\&quot;</span><span class="s"> -v </span><span class="se">\r\n</span><span class="s">&quot;</span>
</span><span class="line">        <span class="k">print</span><span class="p">(</span><span class="n">build_cmd</span><span class="p">)</span>
</span><span class="line">        <span class="k">if</span><span class="p">(</span><span class="n">ct_chan</span><span class="o">.</span><span class="n">send_ready</span><span class="p">()):</span>
</span><span class="line">            <span class="n">ct_chan</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">build_cmd</span><span class="p">)</span>
</span><span class="line">        <span class="n">tCheck2</span> <span class="o">=</span>
</span><span class="line">        <span class="k">while</span> <span class="ow">not</span> <span class="n">ct_chan</span><span class="o">.</span><span class="n">recv_ready</span><span class="p">():</span>
</span><span class="line">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span class="line">            <span class="n">tCheck2</span><span class="o">+=</span><span class="mi">1</span>
</span><span class="line">            <span class="k">if</span> <span class="n">tCheck2</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">:</span>
</span><span class="line">                <span class="k">print</span> <span class="s">&#39;time out&#39;</span><span class="c">#TODO: add exeption here</span>
</span><span class="line">        <span class="k">print</span><span class="p">(</span><span class="n">ct_chan</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">65536</span><span class="p">))</span>
</span><span class="line">        <span class="n">ct_chan</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class="line">        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span><span class="line">        <span class="c">#download the xlf file</span>
</span><span class="line">        <span class="k">try</span><span class="p">:</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_sftp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;/home/ehholli/tmp/&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlf</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlf</span><span class="p">)</span>
</span><span class="line">            <span class="k">print</span><span class="p">(</span><span class="s">&quot;xlf file downloaded successfully!&quot;</span><span class="p">)</span>
</span><span class="line">        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
</span><span class="line">            <span class="k">print</span> <span class="s">&#39;*** Caught exception: </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">__class__</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span class="line">            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</span><span class="line">            <span class="k">try</span><span class="p">:</span>
</span><span class="line">                <span class="bp">self</span><span class="o">.</span><span class="n">closeConn</span><span class="p">()</span>
</span><span class="line">            <span class="k">except</span><span class="p">:</span>
</span><span class="line">                <span class="k">pass</span>
</span><span class="line">            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="sd">&quot;&quot;&quot;Close everything we opened&quot;&quot;&quot;</span>
</span><span class="line">    <span class="k">def</span> <span class="nf">closeConn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_sftp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_t</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class="line"><span class="k">if</span> <span class="n">__name__</span><span class="o">==</span><span class="s">&#39;__main__&#39;</span><span class="p">:</span>
</span><span class="line">    <span class="c"># setup logging</span>
</span><span class="line">    <span class="n">paramiko</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">log_to_file</span><span class="p">(</span><span class="s">&#39;demo_builder.log&#39;</span><span class="p">)</span>
</span><span class="line">    <span class="n">b</span><span class="o">=</span><span class="n">Builder</span><span class="p">(</span><span class="s">&#39;cfg.ini&#39;</span><span class="p">)</span>
</span><span class="line">    <span class="n">b</span><span class="o">.</span><span class="n">createOab</span><span class="p">()</span>
</span><span class="line">    <span class="n">b</span><span class="o">.</span><span class="n">genXlf</span><span class="p">()</span>
</span><span class="line">    <span class="c">#b.runCmd(&#39;ls&#39;)</span>
</span><span class="line">    <span class="n">b</span><span class="o">.</span><span class="n">closeConn</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/01/before-taking-off/">起飞之前</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-01-18T11:50:00+08:00" pubdate data-updated="true">Jan 18<span>th</span>, 2009</time>
        
         | <a href="/2009/01/before-taking-off/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><blockquote>
  <p><strong>英语教员</strong>：Have you watched “<a href="http://www.google.com/url?sa=t&amp;source=web&amp;ct=res&amp;cd=7&amp;url=http%3A%2F%2Fwww.moviexclusive.com%2Freview%2Fredcliff%2Fredcliff.htm&amp;ei=u6FySbmAJJ6GsgLM9qWsBw&amp;usg=AFQjCNFzLu3coQFVzqJeIQFsbu7cYbgycQ&amp;sig2=Bq1O9_ciqzxXqJf4cuVDTA" target="_blank">Red Cliff</a>”? <br />
<strong>本组天才</strong>：Yes, long time ago. It’s a story in the war time.   <br />
<strong>英语教员</strong>：Yeah, tell us about the story…   <br />
<strong>本座</strong>（心里）：What the fuck….There is no story in that shit… <br />
<strong>本组天才</strong>：A revolution woman, Jiang Jie, she … <br />
<strong>英语教员</strong>：Who？ <br />
<strong>本座</strong>：Who？ <br />
<strong>本组天才</strong>：Jiang Jie！</p>

  <p>教员和本座面面相觑。然后大家终于憋不住要祭出中文了：   </p>

  <p><strong>教员</strong>：Jiang Jie是谁啊？《赤壁》里面好像没有啊。 <br />
<strong>本组天才</strong>：啊，Red Cliff是《赤壁》？我以为是《红岩》。   </p>
</blockquote>

<p>然后，人家就准备坐上机机回成都鸟。宰小涛同学专门贡献了一砣采访事故，抄送给所有坚持观看在与业余球员比赛中折戟沉沙的中国男足的壮士：</p>

<blockquote>
  <p><strong>CCAV记者</strong>：请问为虾米要换下表现一直非常出色的17号队员？<br />
<strong>叙利亚主帅</strong>（非常诚恳滴）：因为别个明天早上还要上班。</p>
</blockquote>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/10/the-cheater/">骗子</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-10-26T23:36:00+08:00" pubdate data-updated="true">Oct 26<span>th</span>, 2008</time>
        
         | <a href="/2008/10/the-cheater/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img height="184" alt="71" src="/downloads/images/dark_forest.jpg" width="198" align="left" /> 夏天还是到了尾声，天气变得阴冷。阳光像老人们的睡眠一样变得不知所踪。和往常一样，我被他们晨练的声音吵醒后，就在床上躺十来分钟，听他们在我的窗台下讨论股票和房价、政府和人民、过去和未来。</p>

<p>然后我骑车去上班。我是个怕热不怕冷的人，所以整个夏天都没有骑车。到龙阳路的时候，我看到汽车、摩托车、电瓶车、自行车、行人、协管和警察，混合着漫天的灰尘，像污水一样沿着面目全非的道路争先恐后的缓缓流淌，就好像我是在摩西为以色列人划开的红海一样。</p>

<p>“这里什么时候变成这样了？”我问旁边的人。</p>

<p>他白了我一眼，说：“这里早就这样了。”</p>

<p>这个时候，我的肩膀被人轻轻的拍了一下，一个女孩子从我背后走到面前，说：</p>

<p>“你要不要古董？”</p>

<p>“什么古董？”</p>

<p>“很多。”</p>

<p>她说她是在建筑队打工的。一个星期以前，在挖龙阳路的某个部分时，她找到了不少的铜器和玉器。</p>

<p>“不想要。”</p>

<p>她观察着我的脸色，还观察着从我们身边的路人。她汗津津的鼻尖在并不炎热的天气里显得有些唐突。</p>

<p>“真不想要？你看看这个。”</p>

<p>她又从怀里掏出一个东西，在阳光下泛起闪闪的蓝光。原来是一个鼻烟壶。我接到手里，看到它的色调好像广告牌上的女人一样艳丽而庸俗，有色处和无色处截然分开，还带着数量不少的猪鬃毛眼，一看就是玻璃料做的。</p>

<p>“这是一个翡翠的鼻烟壶。”她把东西从我手里面拿回去，“如果不是因为修路，我们就不可能发现它，你也就没有这么好的机会了。”</p>

<p>“你有多少这样的东西。”</p>

<p>“可多了。”她显然并不善于骗人。在我逼视她的时候，她的眼睛总是不安的转向一边。她搓手的动作也过于频繁，脚还不停的踢着路沿。</p>

<p>“这个鼻烟壶应该有几百年历史了，你应该带回家当传家宝。”</p>

<p>“我没有家里人，我需要钱，我想买一套新衣服。”</p>

<p>“卖了它就为买衣服？要知道这可以卖好几千块钱。”</p>

<p>“我只想卖几百块钱，我只想买一套衣服。这本来也不是我的，我不贪心。”</p>

<p>“可是我只有四十块钱”，我想，我应该帮她一下。</p>

<p>“这怎么可能，你开玩笑吧。”她露出很不老到的夸张的表情，也许是在港产片里面学来的。然后她训练有素的转身就走，脚步却很慢。走了没多远就停下来了。</p>

<p>我饶有兴致的看着她再次转过身来。她的眉头轻轻的皱着，嘴唇随着起伏的胸脯微微的上翘。她的表情和她的处境一样尴尬，这一切都让我着迷。我骑车追上她：</p>

<p>“还是卖给我吧，我身上就这么四十块钱。”</p>

<p>“你真的没带多余的钱？”</p>

<p>她的眉头舒展了，但她却希望自己表现得更加出色。所以她并没有立刻答应，而是装 模作样的抚弄了一下手里的鼻烟壶，才用豁达的江湖语气说：</p>

<p>“好吧，看在你这么诚心的份上，这也是一种缘分。”</p>

<p>缘分果然是所有骗子都要仰仗的东西，我边给她钱边想。我抬手看了看表，离主任开会的时间已经不多了，于是我愉快的揣起鼻烟壶，往科苑路拐去。拐角的地方竖起了施工的围墙，上面大号的隶书显得触目惊心：</p>

<p>“上海欢迎您，世博欢迎您！”</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/07/unicode-introduction/">Unicode漫游指南</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-07-25T00:16:00+08:00" pubdate data-updated="true">Jul 25<span>th</span>, 2008</time>
        
         | <a href="/2008/07/unicode-introduction/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>十年之前，Lenciel拿到人生中第一个黄色游戏<a href="http://www.google.com/search?hl=en&amp;rlz=1B3GGGL_zh-CN___CN231&amp;q=%E5%8F%B0%E6%B9%BE+%E6%99%BA%E5%86%A0+%E9%87%91%E9%99%B5%E5%8D%81%E4%BA%8C%E9%92%97+&amp;btnG=Search&amp;aq=f&amp;oq=" target="_blank">《金陵十二钗》</a>的时候，异常兴奋的打开了它，却看到了乱码。还好，有<a href="http://www.njstar.com/cms/cn/" target="_blank">南极星</a>来帮忙。</p>

<p>十年过的很快，i18n，l10n现在被每个软件公司挂在嘴边。但你会惊奇的发现我们看到乱码的概率丝毫没有比当年降低：看片的时候导入一个繁体的字幕，乱码；打开gmail，乱码；用一个第三方的python库抓网页，乱码……</p>

<p>不过，不用不好意思，并不是菜鸟们才不懂unicode。如果你打开那些记载PHP或者Python的前世今生的<a href="http://ca3.php.net/manual/en/language.types.string.php" target="_blank">网页</a>，你会惊奇的发现这些语言在设计之初对字符的编解码处理是那样的粗糙，你开发一个国际化软件的办法几乎只能是到处<a href="http://www.baidu.com/s?wd=python+can%27t+decode+byte&amp;sourceid=Mozilla-search" target="_blank">求助</a>和<a href="http://blog.ianbicking.org/why-python-unicode-sucks.html" target="_blank">骂娘</a>。</p>

<p>当然，要在电脑上编写出让周杰伦和张伯伦都能看懂的软件的确是需要一些技巧的。而且国际邮件组里面有很多老鸟一辈子都没有见过<a href="http://en.wikipedia.org/wiki/CJK" target="_blank">CJK</a>，他们经常像《<a href="http://www.mtime.com/movie/68393/" target="_blank">The Mist</a>》里面那个疯婆子一样，只会唠叨“source code=plain text=ascii=8 bits characters”。</p>

<p>这当然是像地心说一样过时的错误的观点。本座看到很多亚洲人的反击，说现在“很多代码都可以是unicode的了，那是16个bit的哦”。有的人还为抓到别人话里面的漏洞很兴奋，在信里damn一下对方或者语言设计者。</p>

<p>这，当然也是错误的。unicode和16bit从来就没有必然联系。</p>

<h2 id="section"><strong>治学先治史</strong></h2>

<p>最初计算机可以读的，是小箭猪打孔机处理过的卡片。不久，<a href="http://en.wikipedia.org/wiki/EBCDIC" target="_blank">EBCDIC</a>编码方式得到了使用。这些东西，和现代的计算机编码解码已经无关。</p>

<p><img src="/downloads/images/ascii_table.png" align="right" /></p>

<p>很快，就在Unix出现，K&amp;R开始<a href="http://cm.bell-labs.com/cm/cs/cbook/" target="_blank">写书</a>的时候，EBCDIC退朝，右图所示的<a href="http://www.asciitable.com/" target="_blank">ASCII</a>上位了。ASCII的想法是用32到127之间的数字表示所有的英文字母符号，而0到31位是放控制字。比如7是让电脑“beep”一声等等。因为当时的电脑大都是8位的，ASCII只能用掉7位，有的兽欲无法得到满足的程序员还会在剩余的一位加入自己的邪念：比如当年著名的编辑器WordStar就用每个byte的最高一位来表示后面7位表示的字母是不是一个单词里面的最后一个字母。因为这样华丽的用掉了1位，WordStar变得只能编辑英文，不过那个时候的用户都是讲英文的，所以也就没什么抱怨的声音。</p>

<p>问题就出在，对剩下那个bit，也就是128-255这些码位有邪念的可不是WordStar作者一人。从81年开始，IBM在做IBM-PC的时候，就把它们用来表示一些欧洲的带音调的字母和横条竖条这样的用来做框的记号。因为是出厂的时候做到硬件里面的，所以被称为如右下图所示的<a href="http://en.wikipedia.org/wiki/Code_page_437" target="_blank">OEM</a>的字符集（OEM这个叫法也是这么来的）。</p>

<p><img src="/downloads/images/oem.png" align="right" /></p>

<p>这些电脑很快被卖到了世界各地，于是各种各样的OEM字符集被创造出来，用高128位表示各自需要的字符。例如，完成殖民生活回到英国的奥利弗勋爵就会发现自己发给印度老朋友的电子邮件被抱怨有些字显示不正确。而负责冷战的FBI们更是发现，在自己的机器上打开苏联的文档几乎不可能：对俄语的编码方式实在是太多了。</p>

<p>ANSI（美国国家标准学会）用<code>code pages</code><sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>来表示这种按地域区分的字符集。比如<code>cp936</code>是中文简体，<code>cp862</code>是突厥人用，<code>cp737</code>是希腊人用等等。因此，没有安装某国字符集的电脑在dos里面是<a href="http://www.baidu.com/s?ie=gb2312&amp;bs=EBCDIC&amp;sr=&amp;z=&amp;cl=3&amp;f=8&amp;wd=%D6%D0%CE%C4+cp936&amp;ct=0" target="_blank">看不到</a>你熟悉的语言的。</p>

<p>当亚洲人开始用电脑了之后，事情变得更加混乱。比如天朝文字，是绝对不可能用高128位来放完的。于是<code>DBCS</code>（double byte character set）又来救场：用16个bit位对字符进行编码。</p>

<p>但是对于大多数写程序的人来说，他们仍然认为一个字符是8bit，因为他们很少需要把一种语言的字符拿到另一种语言的平台上去处理。不过，当世界很多角落都已经通了internet之后，世界变平了。人们看到了满坑满谷的乱码，于是<code>Unicode</code>出现了。</p>

<h2 id="unicode"><strong>Unicode</strong></h2>

<p><code>Unicode</code>组织和天朝搞奥运会一样，一出来就是打着同一个世界，同一个字符集的口号。不过，和航空爱好者普遍以为“太空没有重力”一样，有很多<code>Unicode</code>的支持者都以为<code>Unicode</code>是一种16位的字符集，<strong>这种想法其实是不对的</strong>。</p>

<p>实际上Unicode是对世界上所有的字符分配了一个所谓<code>code point</code>的码位。</p>

<p><img src="/downloads/images/apple_code_table.jpg" alt="unicode" title="Don't touch me..." /></p>

<p>你可以在Windows的命令行输入<code>charmap</code>来查看这些码位。比如字母A，它的unicode码位是<code>+U0041</code>，而不幸被本座选中的汉字是<code>U+04C7</code>。</p>

<p><img src="/downloads/images/unicode.png" alt="unicode" title="Don't touch me..." /></p>

<p>由于世界上有如此多的字符，实际上0到65535的code point早就已经被用光了。也就是说，16个bit并不能装下所有的Unicode。</p>

<p>而且，在内存或者硬盘上，字符究竟是以什么样的bit位的形式存在的，其实还要看这些字符是怎么被编码的。比如我们查到“全部”这个词的Unicode码位：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">&gt; 全：  +U5168
</span><span class="line">&gt; 部： +U90E8</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>那么这两坨<code>u5168\u90e8</code>怎么在内存中放置，还要看你是用的哪种编码才能确定。</p>

<h2 id="section-1"><strong>编码</strong></h2>

<p>Unicode的编码，最先被想到也是最容易被想到的，就是使用两个byte，16个bit（这也是后来造成unicode是双字节的误会的起源）。比如我们前面说了“全部”：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">&gt; 全部 :  +U5168 +U90E8</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>那么用</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">&gt; 51 68 90 E8</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>来表示不就可以了。但是，你也许会想，下面的编码为啥不行呢：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">&gt; 68 51 E8 90</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>是啊，这个软件开发中古老的<a href="http://www.google.com/search?q=%E5%A4%A7%E5%B0%8F%E7%AB%AF%E5%AF%B9%E9%BD%90%E9%97%AE%E9%A2%98&amp;sourceid=navclient-ff&amp;ie=UTF-8&amp;rlz=1B3GGGL_zh-CN___CN231&amp;aq=h" target="_blank">大小端对齐问题</a>又冒出来了。于是人们开始用<code>FE FF</code>这个格式的<code>Unicode Byte Order Mark</code>(简称<code>BOM</code>）来进行标识：从文件头里面读出<code>FF FE</code>的兄弟们知道，后面所有字符的大小端都要进行互换。需要注意的是，<code>FE FF</code>只是<code>BOM</code>的一种，而且，不是每个文件都那么守规矩：有的会没有<code>BOM</code>标志。</p>

<p>世界清静了一段时间，每个人都过得幸福美满。但是不久，使用英语的主流程序员队伍看到内存里面大片大片的<code>00</code>（英文的Unicode都是<code>+U00FF</code>以下的，记得吗？），就难免有希望处理稀疏矩阵的怨念。也难怪，他们又不是中国的官僚，看到那么多旧格式的文档需要转换，看到同样的英文文档保存的大小翻倍了，他们当然会怨念。于是，<code>Unicode</code>组织也和天朝首次申奥一样，在相当长的一段时间内被人淡忘了。</p>

<h2 id="utf-8"><strong>UTF-8</strong></h2>

<p>UTF-8<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup>的思想一句话就能说清：对code point分段进行编码。从0-127的用8个bit，后面的用16个、24个、32个…</p>

<p>同时，人们把过去那种编码方式称为UTF-16（因为是用16个bit）或者UCS-2（因为是2个byte）。
<img src="/downloads/images/utf8.png" align="right" />可以看出来，UTF-8的编码方式中，英文字母的编码和ASCII中是一致的。对于美国的软件工程师而言，使用UTF-8工作和ASCII工作的差异被抹去了。而且你也不需要像UCS-2那样去分辨它是大端对齐还是小端对齐的了。</p>

<p>当然，对Unicode的编码方式还远不只这两种。我们常常可以看到UTF-7，UCS-4这样的编码方式（后面这种腐败的编码方式，估计是天朝的乡长发明的）。</p>

<p>由于很多旧的<code>encoding</code>方式下，有的Unicode的码位没有包含，比如传统的欧洲字符集<code>ISO-8859-1</code><sup id="fnref:3"><a href="#fn:3" rel="footnote">3</a></sup> ，如果你要它显示中文，就会看到一串的问号。而UTF-x则都包括了所有的Unicode的<code>code point</code>。</p>

<h2 id="section-2"><strong>你只要记住一点点</strong></h2>

<p>你居然读到了这里……好吧，我知道，不是每个人都需要知道上面的东西。作为程序员你只需要知道一件事情：</p>

<blockquote>
  <p><strong>字符是使用什么编码方式被编码的</strong></p>
</blockquote>

<p>如果你在看到乱码的时候，那些七七八八的字符在内存或者文件里面是用什么方式保存的你都不清楚的话，那<a href="http://www.google.com/search?q=ms-dos%E7%AA%97%E5%8F%A3%E4%B9%B1%E7%A0%81&amp;sourceid=navclient-ff&amp;ie=UTF-8&amp;rlz=1B3GGGL_zh-CN___CN231&amp;aq=h">ms-dos窗口乱码</a>了，<a href="http://www.google.com/search?hl=en&amp;rlz=1B3GGGL_zh-CN___CN231&amp;q=%E8%BE%93%E5%87%BA%E7%9A%84%E6%96%87%E4%BB%B6%E4%B9%B1%E7%A0%81&amp;btnG=Search&amp;aq=f&amp;oq=">输出的文件乱码</a>了，<a href="http://www.google.com/search?hl=en&amp;rlz=1B3GGGL_zh-CN___CN231&amp;q=eclipse%E7%9A%84console%E4%B9%B1%E7%A0%81&amp;btnG=Search&amp;aq=f&amp;oq=">eclipse的console乱码</a>了，的确会让你觉得号称平了的世界挺不友好的。这篇文章介绍了一点基本知识，并不是对症下药。希望你看完了本文，能够做到心中有码。</p>

<p>下面是一些有趣的Unicode码，来自<a href="http://wiki.secondlife.com/wiki/Unicode_In_5_Minutes">这里</a>：</p>

<p><img src="/downloads/images/unicode_fun.png" alt="unicode fun" title="Don't touch me..." /></p>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>http://www.i18nguy.com/unicode/codepages.html#msftdos     <a href="#fnref:1" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p>http://www.ietf.org/rfc/rfc3629.txt    <a href="#fnref:2" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:3">
      <p>http://www.htmlhelp.com/reference/charset/    <a href="#fnref:3" rel="reference">&#8617;</a></p>
    </li>
  </ol>
</div>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/12/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/10/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    
  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Lenciel Li<span class="theme-version">Octopress-Lenciel 0.1</span>
  <section class="contruction-wrap">
    <div class="contruction"></div>
  </section>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'lencielgithub';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>



<!--














                                            IIIIIIIIII       I
                  II                     IIIIIIIIIIIIIIIIIIII
                  IIII                  IIIIIIIIIIIIIIIIIIII
                  IIIIII                IIIIIIIIIIIIIIIIII III
                  IIIIIIII             IIIIIIIIIIIIIIIIIIIIII
                  IIIIIIIIIII          IIIIIIIIIIIIIIIIIIIII
                  IIIIIIIIIIIIII       IIIIIIIIIIIIIIIIIII
                   IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                  I  IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                  IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                  IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                   IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                    IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                     IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                         IIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                     IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                      IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                        IIIIIIIIIIIIIIIIIIIIIIIIIIIII
                           IIIIIIIIIIIIIIIIIIIIIIIII
                             IIIIIIIIIIIIIIIIIIIII
                          IIIIIIIIIIIIIIIIIIIIIII
                I   IIIIIIIIIIIIIIIIIIIIIIIIII
                  IIIIIIIIIIIIIIIIIIIIIIIIII
                      IIIIIIIIIIIIIIIIII















 -->


</body>
</html>
