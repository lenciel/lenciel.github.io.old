
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>x2blog搬迁到wordpress - @Lenciel</title>
  <meta name="author" content="Lenciel Li">

  
  <meta name="description" content="X2blog搬迁到wordpress Apr 17th, 2007 前面有讲对xml/html的库选择。既然例完假利完器，就要善其事了。其实x2blog提供了备份导出的功能，让整个事情变得非常简单。相比之下，歪酷本来有此功能现在却不知为何关闭了，让用户从歪酷搬走变得难上加难。 首先， &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://lenciel.cn/docs/x2blog-to-wordpress/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/github/lenciel" rel="alternate" title="@Lenciel" type="application/atom+xml">
  <!-- Facebook Open Graph
     Facebook Debugger: https://developers.facebook.com/tools/debug -->
<meta property="og:title" content="x2blog搬迁到wordpress" /><meta itemprop="name" content="x2blog搬迁到wordpress" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://lenciel.cn/docs/x2blog-to-wordpress/" />
<meta property="og:description" content="X2blog搬迁到wordpress Apr 17th, 2007 前面有讲对xml/html的库选择。既然例完假利完器，就要善其事了。其实x2blog提供了备份导出的功能，让整个事情变得非常简单。相比之下，歪酷本来有此功能现在却不知为何关闭了，让用户从歪酷搬走变得难上加难。 首先， &hellip;" />

<meta property="og:site_name" content="http://lenciel.cn" />
<meta property="article:author" content="https://plus.google.com/114787528537231301324">
<meta property="article:published_time" content="2007-04-17 13:24" />


<meta itemprop="description" content="X2blog搬迁到wordpress Apr 17th, 2007 前面有讲对xml/html的库选择。既然例完假利完器，就要善其事了。其实x2blog提供了备份导出的功能，让整个事情变得非常简单。相比之下，歪酷本来有此功能现在却不知为何关闭了，让用户从歪酷搬走变得难上加难。 首先， &hellip;" />

<!-- Combine multiple fonts into one request -->
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic|Patua+One|Yanone+Kaffeesatz" rel="stylesheet" type="text/css">
<!-- jQuery -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>

  <script>
  !function(g,s,q,r,d){r=g[r]=g[r]||function(){(r.q=r.q||[]).push(
  arguments)};d=s.createElement(q);q=s.getElementsByTagName(q)[0];
  d.src='//d1l6p2sc9645hc.cloudfront.net/tracker.js';q.parentNode.
  insertBefore(d,q)}(window,document,'script','_gs');

  _gs('GSN-360316-J');
</script>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-175991-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">@Lenciel</a></h1>
  
    <h2>Thoughts and Rants.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/github/lenciel" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:lenciel.cn" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/"><i class="icon-home"></i>Home</a></li>
  <li><a href="/blog/archives"><i class="icon-book-alt"></i>Archives</a><span class="divider"></span></li>
  <li><a href="/about"><i class="icon-user"></i>About</a><span class="divider"></span></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article role="article">
  
  <header>
    <h1 class="entry-title">X2blog搬迁到wordpress</h1>
    <p class="meta">








  


<time datetime="2007-04-17T13:24:00+08:00" pubdate data-updated="true">Apr 17<span>th</span>, 2007</time></p>
  </header>
  
  <p>前面有讲对xml/html的库选择。既然<strike>例完假</strike>利完器，就要善其事了。其实x2blog提供了备份导出的功能，让整个事情变得非常简单。相比之下，歪酷本来有此功能现在却不知为何关闭了，让用户从歪酷搬走变得难上加难。</p>

<p>首先，x2blog导出的是按照月份为单位的日志，如下图所示：</p>

<p><img src="/downloads/images/2008_09/x2w1.jpg" alt="x2w1" title="Don't touch me..." /></p>

<p>每个xml文件的格式都是相同的，如下图所示：</p>

<p><img src="/downloads/images/2008_09/x2w2.jpg" alt="x2w1" title="Don't touch me..." /></p>

<p>可以从图里面看到，<code>Info</code>节点的title就是blog的名称，而每个Item对应着一篇日志。这里有点诡异的是所有日志的内容都在<code>Abstract</code>节点里面，而不是<code>Content</code>节点里面，估计是x2blog这个日志程序的bug。</p>

<p>有了这些信息，就可以去生成wordpress可以读懂的<a href="http://en.forums.wordpress.com/topic/what-is-an-wordpress-extended-rss-wxr-file" target="_blank">wxr文件</a>了。</p>

<p>首先做一个类，初始化的时候就生成那些通用的内容，如xml声明部分等：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
</span><span class="line">        <span class="sd">&quot;&quot;&quot;Creates the basic document.&quot;&quot;&quot;</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">input_tree</span> <span class="o">=</span> <span class="nb">input</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
</span><span class="line">
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">xml</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">dom</span><span class="o">.</span><span class="n">minidom</span><span class="o">.</span><span class="n">Document</span><span class="p">()</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">rss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;rss&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">rss</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s">&#39;xmlns:content&#39;</span><span class="p">,</span>
</span><span class="line">                              <span class="s">&#39;http://purl.org/rss/1.0/modules/content/&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">rss</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s">&#39;xmlns:wfw&#39;</span><span class="p">,</span>
</span><span class="line">                              <span class="s">&#39;http://wellformedweb.org/CommentAPI/&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">rss</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s">&#39;xmlns:dc&#39;</span><span class="p">,</span> <span class="s">&#39;http://purl.org/dc/elements/1.1/&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">rss</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s">&#39;xmlns:wp&#39;</span><span class="p">,</span> <span class="s">&#39;http://wordpress.org/export/1.0/&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;channel&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rss</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>然后就需要分别生成wordpress的cata、tag、item、comment这四部分内容。不过x2blog的导出备份文件里面并没有tag信息（又是一个bug吧），所以tag先不管。</p>

<p>日志分类处理</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">def</span> <span class="nf">create_category</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nicename</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
</span><span class="line">        <span class="sd">&quot;&quot;&quot;Creates a Category.&quot;&quot;&quot;</span>
</span><span class="line">        <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
</span><span class="line">            <span class="n">category</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:category&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="p">)</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:category_nicename&#39;</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">nicename</span><span class="p">)</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:category_parent&#39;</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span>
</span><span class="line">            <span class="n">element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:cat_name&#39;</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_cdata</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>日志</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">def</span> <span class="nf">create_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span class="line">        <span class="sd">&quot;&quot;&quot;Creates an item from the Item element in the tree.&quot;&quot;&quot;</span>
</span><span class="line">        <span class="n">linkpath</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">,</span><span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M:%S&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y/%m/</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="n">link</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">site</span><span class="p">,</span> <span class="n">linkpath</span><span class="p">,</span> <span class="n">data</span><span class="p">[]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">))</span>
</span><span class="line">        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;item&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">data</span><span class="p">[]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">))</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;link&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">link</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;pubDate&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span>
</span><span class="line">                            <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">,</span><span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M:%S&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%a, </span><span class="si">%d</span><span class="s"> %b %Y %H:%M%S +0000&#39;</span><span class="p">))</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;dc:creator&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;admin&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">item_categories</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">))</span>
</span><span class="line">        <span class="c">#no tag info, just left there</span>
</span><span class="line">        <span class="c">#self.item_tags(item, xxx)</span>
</span><span class="line">        <span class="n">guid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;guid&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">link</span><span class="p">)</span>
</span><span class="line">        <span class="n">guid</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s">&#39;isPermaLink&#39;</span><span class="p">,</span> <span class="s">&#39;true&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;description&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
</span><span class="line">        <span class="n">element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;content:encoded&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_cdata</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">),</span> <span class="n">element</span><span class="p">)</span>
</span><span class="line">        <span class="c">#self._create_element(&#39;wp:post_id&#39;, item, data[0])</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:post_date&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:post_date_gmt&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span class="line">        <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;open&#39;</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:comment_status&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">comments</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:ping_status&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;open&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:post_name&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">data</span><span class="p">[]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">))</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:status&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;publish&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:post_parent&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;0&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:menu_item&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;0&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:post_type&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;post&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">item_comments</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>评论</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">def</span> <span class="nf">item_comments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">comment_elems</span><span class="p">):</span>
</span><span class="line">        <span class="sd">&quot;&quot;&quot;Creates comments for an item.&quot;&quot;&quot;</span>
</span><span class="line">        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">comment_elems</span><span class="p">:</span>
</span><span class="line">            <span class="n">comment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:comment&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
</span><span class="line">            <span class="c">#self._create_element(&#39;wp:comment_id&#39;, comment, elem[0])</span>
</span><span class="line">            <span class="n">element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:comment_author&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="p">)</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_cdata</span><span class="p">(</span><span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">),</span> <span class="n">element</span><span class="p">)</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:comment_author_email&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="p">,</span> <span class="s">&#39;x@y.com&#39;</span><span class="p">)</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:comment_author_url&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="p">,</span> <span class="s">&#39;http://xxx&#39;</span><span class="p">)</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:comment_author_IP&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="p">,</span> <span class="n">elem</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">))</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:comment_date&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="p">,</span> <span class="n">elem</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">))</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:comment_date_gmt&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="p">,</span> <span class="n">elem</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">))</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:comment_content&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="p">,</span> <span class="n">elem</span><span class="p">[]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">))</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:comment_approved&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="p">,</span> <span class="s">&#39;1&#39;</span><span class="p">)</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:comment_type&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="p">)</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:comment_parent&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="p">,</span> <span class="s">&#39;0&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>实际的文件解析处理过程，都放到了另外一个类里面来使得结构清晰。完整的代码：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span> (x2wp.py)</span> <a href="/downloads/code/x2wp.py">download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
<span class="line-number">79</span>
<span class="line-number">80</span>
<span class="line-number">81</span>
<span class="line-number">82</span>
<span class="line-number">83</span>
<span class="line-number">84</span>
<span class="line-number">85</span>
<span class="line-number">86</span>
<span class="line-number">87</span>
<span class="line-number">88</span>
<span class="line-number">89</span>
<span class="line-number">90</span>
<span class="line-number">91</span>
<span class="line-number">92</span>
<span class="line-number">93</span>
<span class="line-number">94</span>
<span class="line-number">95</span>
<span class="line-number">96</span>
<span class="line-number">97</span>
<span class="line-number">98</span>
<span class="line-number">99</span>
<span class="line-number">100</span>
<span class="line-number">101</span>
<span class="line-number">102</span>
<span class="line-number">103</span>
<span class="line-number">104</span>
<span class="line-number">105</span>
<span class="line-number">106</span>
<span class="line-number">107</span>
<span class="line-number">108</span>
<span class="line-number">109</span>
<span class="line-number">110</span>
<span class="line-number">111</span>
<span class="line-number">112</span>
<span class="line-number">113</span>
<span class="line-number">114</span>
<span class="line-number">115</span>
<span class="line-number">116</span>
<span class="line-number">117</span>
<span class="line-number">118</span>
<span class="line-number">119</span>
<span class="line-number">120</span>
<span class="line-number">121</span>
<span class="line-number">122</span>
<span class="line-number">123</span>
<span class="line-number">124</span>
<span class="line-number">125</span>
<span class="line-number">126</span>
<span class="line-number">127</span>
<span class="line-number">128</span>
<span class="line-number">129</span>
<span class="line-number">130</span>
<span class="line-number">131</span>
<span class="line-number">132</span>
<span class="line-number">133</span>
<span class="line-number">134</span>
<span class="line-number">135</span>
<span class="line-number">136</span>
<span class="line-number">137</span>
<span class="line-number">138</span>
<span class="line-number">139</span>
<span class="line-number">140</span>
<span class="line-number">141</span>
<span class="line-number">142</span>
<span class="line-number">143</span>
<span class="line-number">144</span>
<span class="line-number">145</span>
<span class="line-number">146</span>
<span class="line-number">147</span>
<span class="line-number">148</span>
<span class="line-number">149</span>
<span class="line-number">150</span>
<span class="line-number">151</span>
<span class="line-number">152</span>
<span class="line-number">153</span>
<span class="line-number">154</span>
<span class="line-number">155</span>
<span class="line-number">156</span>
<span class="line-number">157</span>
<span class="line-number">158</span>
<span class="line-number">159</span>
<span class="line-number">160</span>
<span class="line-number">161</span>
<span class="line-number">162</span>
<span class="line-number">163</span>
<span class="line-number">164</span>
<span class="line-number">165</span>
<span class="line-number">166</span>
<span class="line-number">167</span>
<span class="line-number">168</span>
<span class="line-number">169</span>
<span class="line-number">170</span>
<span class="line-number">171</span>
<span class="line-number">172</span>
<span class="line-number">173</span>
<span class="line-number">174</span>
<span class="line-number">175</span>
<span class="line-number">176</span>
<span class="line-number">177</span>
<span class="line-number">178</span>
<span class="line-number">179</span>
<span class="line-number">180</span>
<span class="line-number">181</span>
<span class="line-number">182</span>
<span class="line-number">183</span>
<span class="line-number">184</span>
<span class="line-number">185</span>
<span class="line-number">186</span>
<span class="line-number">187</span>
<span class="line-number">188</span>
<span class="line-number">189</span>
<span class="line-number">190</span>
<span class="line-number">191</span>
<span class="line-number">192</span>
<span class="line-number">193</span>
<span class="line-number">194</span>
<span class="line-number">195</span>
<span class="line-number">196</span>
<span class="line-number">197</span>
<span class="line-number">198</span>
<span class="line-number">199</span>
<span class="line-number">200</span>
<span class="line-number">201</span>
<span class="line-number">202</span>
<span class="line-number">203</span>
<span class="line-number">204</span>
<span class="line-number">205</span>
<span class="line-number">206</span>
<span class="line-number">207</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="sd">&quot;&quot;&quot;Script to generate a WordPress eXtended RSS (WXR) file from a x2blog backup file</span>
</span><span class="line"><span class="sd">&quot;&quot;&quot;</span>
</span><span class="line">
</span><span class="line"><span class="c"># 2008 Lenciel &lt;lenciel@gmail.com&gt;.</span>
</span><span class="line">
</span><span class="line"><span class="c">#import psycopg2</span>
</span><span class="line"><span class="kn">import</span> <span class="nn">re</span>
</span><span class="line"><span class="kn">import</span> <span class="nn">sys</span>
</span><span class="line"><span class="kn">import</span> <span class="nn">xml.dom.minidom</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
</span><span class="line">
</span><span class="line"><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">optparse</span> <span class="kn">import</span> <span class="n">OptionParser</span>
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">Export</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span class="line">    <span class="sd">&quot;&quot;&quot;Handles the details of creating a WordPress eXtended RSS (WXR).&quot;&quot;&quot;</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
</span><span class="line">        <span class="sd">&quot;&quot;&quot;Creates the basic document.&quot;&quot;&quot;</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">input_tree</span> <span class="o">=</span> <span class="nb">input</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
</span><span class="line">
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">xml</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">dom</span><span class="o">.</span><span class="n">minidom</span><span class="o">.</span><span class="n">Document</span><span class="p">()</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">rss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;rss&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">rss</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s">&#39;xmlns:content&#39;</span><span class="p">,</span>
</span><span class="line">                              <span class="s">&#39;http://purl.org/rss/1.0/modules/content/&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">rss</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s">&#39;xmlns:wfw&#39;</span><span class="p">,</span>
</span><span class="line">                              <span class="s">&#39;http://wellformedweb.org/CommentAPI/&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">rss</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s">&#39;xmlns:dc&#39;</span><span class="p">,</span> <span class="s">&#39;http://purl.org/dc/elements/1.1/&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">rss</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s">&#39;xmlns:wp&#39;</span><span class="p">,</span> <span class="s">&#39;http://wordpress.org/export/1.0/&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;channel&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rss</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">_create_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
</span><span class="line">        <span class="sd">&quot;&quot;&quot;Helper function for creating XML elements.</span>
</span><span class="line">
</span><span class="line"><span class="sd">        Parameters:</span>
</span><span class="line"><span class="sd">        :param name: The name of the element</span>
</span><span class="line"><span class="sd">        :type name: ``str``</span>
</span><span class="line"><span class="sd">        :param parent: (Optional) The XML node you want this element to be a</span>
</span><span class="line"><span class="sd">        child of.</span>
</span><span class="line"><span class="sd">        :type b: ``Node``</span>
</span><span class="line">
</span><span class="line"><span class="sd">        :return: The element</span>
</span><span class="line"><span class="sd">        :rtype: ``Node``.</span>
</span><span class="line"><span class="sd">        &quot;&quot;&quot;</span>
</span><span class="line">        <span class="n">element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml</span><span class="o">.</span><span class="n">createElement</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
</span><span class="line">
</span><span class="line">        <span class="k">if</span> <span class="n">parent</span><span class="p">:</span>
</span><span class="line">            <span class="n">parent</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
</span><span class="line">            <span class="n">element_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml</span><span class="o">.</span><span class="n">createTextNode</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
</span><span class="line">            <span class="n">element</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">element_value</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">        <span class="k">return</span> <span class="n">element</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="sd">&quot;&quot;&quot;Returns the formatted XML document.&quot;&quot;&quot;</span>
</span><span class="line">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml</span><span class="o">.</span><span class="n">toprettyxml</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">create_site_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
</span><span class="line">        <span class="sd">&quot;&quot;&quot;Populates the site information.&quot;&quot;&quot;</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">url</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;link&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;description&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;pubDate&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">())</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;generator&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="p">,</span> <span class="s">&#39;x2wp.py&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;language&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="p">,</span> <span class="s">&#39;cn&#39;</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">create_category</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nicename</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
</span><span class="line">        <span class="sd">&quot;&quot;&quot;Creates a Category.&quot;&quot;&quot;</span>
</span><span class="line">        <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
</span><span class="line">            <span class="n">category</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:category&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="p">)</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:category_nicename&#39;</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">nicename</span><span class="p">)</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:category_parent&#39;</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span>
</span><span class="line">            <span class="n">element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:cat_name&#39;</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_cdata</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">create_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span class="line">        <span class="sd">&quot;&quot;&quot;Creates an item from the Item element in the tree.&quot;&quot;&quot;</span>
</span><span class="line">        <span class="n">linkpath</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">,</span><span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M:%S&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y/%m/</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="n">link</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">site</span><span class="p">,</span> <span class="n">linkpath</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">))</span>
</span><span class="line">        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;item&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">))</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;link&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">link</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;pubDate&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span>
</span><span class="line">                            <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">,</span><span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M:%S&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%a, </span><span class="si">%d</span><span class="s"> %b %Y %H:%M%S +0000&#39;</span><span class="p">))</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;dc:creator&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;admin&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">item_categories</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">))</span>
</span><span class="line">        <span class="c">#no tag info, just left there</span>
</span><span class="line">        <span class="c">#self.item_tags(item, xxx)</span>
</span><span class="line">        <span class="n">guid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;guid&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">link</span><span class="p">)</span>
</span><span class="line">        <span class="n">guid</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s">&#39;isPermaLink&#39;</span><span class="p">,</span> <span class="s">&#39;true&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;description&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
</span><span class="line">        <span class="n">element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;content:encoded&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_cdata</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">),</span> <span class="n">element</span><span class="p">)</span>
</span><span class="line">        <span class="c">#self._create_element(&#39;wp:post_id&#39;, item, data[0])</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:post_date&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:post_date_gmt&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span class="line">        <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;open&#39;</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:comment_status&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">comments</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:ping_status&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;open&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:post_name&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">))</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:status&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;publish&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:post_parent&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;0&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:menu_item&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;0&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:post_type&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="s">&#39;post&#39;</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">item_comments</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">item_categories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">cata</span><span class="p">):</span>
</span><span class="line">        <span class="sd">&quot;&quot;&quot;Links an item to categories.&quot;&quot;&quot;</span>
</span><span class="line">        <span class="n">element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;category&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_cdata</span><span class="p">(</span><span class="n">cata</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">create_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span><span class="line">        <span class="sd">&quot;&quot;&quot;Creates a Tag.&quot;&quot;&quot;</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">item_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">item_id</span><span class="p">):</span>
</span><span class="line">        <span class="sd">&quot;&quot;&quot;Links an item to tags.&quot;&quot;&quot;</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">item_comments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">comment_elems</span><span class="p">):</span>
</span><span class="line">        <span class="sd">&quot;&quot;&quot;Creates comments for an item.&quot;&quot;&quot;</span>
</span><span class="line">        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">comment_elems</span><span class="p">:</span>
</span><span class="line">            <span class="n">comment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:comment&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
</span><span class="line">            <span class="c">#self._create_element(&#39;wp:comment_id&#39;, comment, elem[0])</span>
</span><span class="line">            <span class="n">element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:comment_author&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="p">)</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_cdata</span><span class="p">(</span><span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">),</span> <span class="n">element</span><span class="p">)</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:comment_author_email&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="p">,</span> <span class="s">&#39;x@y.com&#39;</span><span class="p">)</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:comment_author_url&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="p">,</span> <span class="s">&#39;http://xxx&#39;</span><span class="p">)</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:comment_author_IP&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="p">,</span> <span class="n">elem</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">))</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:comment_date&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="p">,</span> <span class="n">elem</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">))</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:comment_date_gmt&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="p">,</span> <span class="n">elem</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">))</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:comment_content&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="p">,</span> <span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">))</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:comment_approved&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="p">,</span> <span class="s">&#39;1&#39;</span><span class="p">)</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:comment_type&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="p">)</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">_create_element</span><span class="p">(</span><span class="s">&#39;wp:comment_parent&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="p">,</span> <span class="s">&#39;0&#39;</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">_cdata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
</span><span class="line">        <span class="sd">&quot;&quot;&quot;Helper function for creating CDATA sections.&quot;&quot;&quot;</span>
</span><span class="line">        <span class="n">cdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml</span><span class="o">.</span><span class="n">createCDATASection</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span class="line">        <span class="n">parent</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">cdata</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">finalise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="sd">&quot;&quot;&quot;Final cleanup.&quot;&quot;&quot;</span>
</span><span class="line">        <span class="n">wxr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</span><span class="line">        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;&gt;</span><span class="se">\n</span><span class="s">&lt;!&#39;</span><span class="p">,</span> <span class="s">&#39;&gt;&lt;!&#39;</span><span class="p">,</span> <span class="n">wxr</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">Exporter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span class="line">    <span class="sd">&quot;&quot;&quot;Handles the wrap process.&quot;&quot;&quot;</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">output_file</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">output</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">input_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_input</span><span class="p">()</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">wxr</span> <span class="o">=</span> <span class="n">Export</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_tree</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">_get_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="sd">&quot;&quot;&quot;get a etree from file.&quot;&quot;&quot;</span>
</span><span class="line">        <span class="k">try</span><span class="p">:</span>
</span><span class="line">            <span class="n">parser</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">XMLParser</span><span class="p">(</span><span class="n">ns_clean</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class="line">            <span class="n">input_tree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">input</span> <span class="p">,</span><span class="n">parser</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">        <span class="k">except</span><span class="p">(</span><span class="n">lxml</span><span class="o">.</span><span class="n">etree</span><span class="o">.</span><span class="n">XMLSyntaxError</span><span class="p">):</span>
</span><span class="line">            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s">&quot;I am unable to parse the file you supplied. Sorry.&quot;</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">        <span class="k">return</span> <span class="n">input_tree</span>
</span><span class="line">
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">_process_input_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="sd">&quot;&quot;&quot;Creates the basic document. No tags because there are not in the x2blog backup file.</span>
</span><span class="line"><span class="sd">        &quot;&quot;&quot;</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">wxr</span><span class="o">.</span><span class="n">create_site_info</span><span class="p">(</span><span class="s">&quot;the site info&quot;</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="s">&quot;description&quot;</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_tree</span><span class="o">.</span><span class="n">getroot</span><span class="p">():</span>
</span><span class="line">            <span class="c">#self.wxr.create_tag()</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">wxr</span><span class="o">.</span><span class="n">create_category</span><span class="p">(</span><span class="n">child</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">),</span><span class="n">child</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">))</span>
</span><span class="line">            <span class="bp">self</span><span class="o">.</span><span class="n">wxr</span><span class="o">.</span><span class="n">create_item</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">export</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="sd">&quot;&quot;&quot;Generates the WXR.&quot;&quot;&quot;</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">_process_input_tree</span><span class="p">()</span>
</span><span class="line">        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wxr</span><span class="o">.</span><span class="n">finalise</span><span class="p">()</span>
</span><span class="line">
</span><span class="line">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_file</span><span class="p">:</span>
</span><span class="line">            <span class="n">out</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_file</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
</span><span class="line">            <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</span><span class="line">            <span class="n">out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class="line">        <span class="k">else</span><span class="p">:</span>
</span><span class="line">            <span class="k">print</span> <span class="n">output</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">parseoptions</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
</span><span class="line">    <span class="sd">&quot;&quot;&quot;Parses command line options.&quot;&quot;&quot;</span>
</span><span class="line">    <span class="n">parser</span> <span class="o">=</span> <span class="n">OptionParser</span><span class="p">()</span>
</span><span class="line">    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&quot;-i&quot;</span><span class="p">,</span> <span class="s">&quot;--input&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;string&quot;</span><span class="p">,</span>
</span><span class="line">                      <span class="n">help</span><span class="o">=</span><span class="s">&quot;The filename to be process.&quot;</span><span class="p">)</span>
</span><span class="line">    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&quot;-o&quot;</span><span class="p">,</span> <span class="s">&quot;--output&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;string&quot;</span><span class="p">,</span>
</span><span class="line">                      <span class="n">help</span><span class="o">=</span><span class="s">&quot;The filename where you want the output stored.&quot;</span><span class="p">)</span>
</span><span class="line">    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&quot;-u&quot;</span><span class="p">,</span> <span class="s">&quot;--url&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&quot;http://lenciel.cn&quot;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s">&quot;string&quot;</span><span class="p">,</span>
</span><span class="line">                  <span class="n">help</span><span class="o">=</span><span class="s">&quot;The url you use for your new wordpress blog.&quot;</span><span class="p">)</span>
</span><span class="line">    <span class="k">return</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span class="line">
</span><span class="line"><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
</span><span class="line">    <span class="n">options</span> <span class="o">=</span> <span class="n">parseoptions</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
</span><span class="line">    <span class="n">exporter</span> <span class="o">=</span> <span class="n">Exporter</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
</span><span class="line">    <span class="n">exporter</span><span class="o">.</span><span class="n">export</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


  
    <footer>
      <p class="meta">
        
        








  


<time datetime="2007-04-17T13:24:00+08:00" pubdate data-updated="true">Apr 17<span>th</span>, 2007</time>
        
      </p>
      
        <div class="sharing">
  
  
  
  <!-- JiaThis Button BEGIN -->
  <div class="jiathis_style_24x24">
    <a class="jiathis_button_qzone"></a>
    <a class="jiathis_button_tsina"></a>
    <a class="jiathis_button_tqq"></a>
    <a class="jiathis_button_weixin"></a>
    <a class="jiathis_button_renren"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
    <a class="jiathis_counter_style"></a>
  </div>
  <script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
  <!-- JiaThis Button END -->
</div>

      
    </footer>
  
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    
  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
Blog theme: <a href="https://github.com/lenciel/octopress-theme-lenciel">Octopress-Lenciel 0.1</a>
<span class="theme-version">Copyright &copy; 2014 - Lenciel Li</span>
  <section class="contruction-wrap">
    <div class="contruction"></div>
  </section>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'lencielgithub';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://lenciel.cn/docs/x2blog-to-wordpress/index.html';
        var disqus_url = 'http://lenciel.cn/docs/x2blog-to-wordpress/index.html';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>









<!--














                                            IIIIIIIIII       I
                  II                     IIIIIIIIIIIIIIIIIIII
                  IIII                  IIIIIIIIIIIIIIIIIIII
                  IIIIII                IIIIIIIIIIIIIIIIII III
                  IIIIIIII             IIIIIIIIIIIIIIIIIIIIII
                  IIIIIIIIIII          IIIIIIIIIIIIIIIIIIIII
                  IIIIIIIIIIIIII       IIIIIIIIIIIIIIIIIII
                   IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                  I  IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                  IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                  IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                   IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                    IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                     IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                         IIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                     IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                      IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                        IIIIIIIIIIIIIIIIIIIIIIIIIIIII
                           IIIIIIIIIIIIIIIIIIIIIIIII
                             IIIIIIIIIIIIIIIIIIIII
                          IIIIIIIIIIIIIIIIIIIIIII
                I   IIIIIIIIIIIIIIIIIIIIIIIIII
                  IIIIIIIIIIIIIIIIIIIIIIIIII
                      IIIIIIIIIIIIIIIIII















 -->


</body>
</html>
