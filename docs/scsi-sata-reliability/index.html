
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>SCSI和SATA的稳定性 - @Lenciel</title>
  <meta name="author" content="Lenciel Li">

  
  <meta name="description" content="SCSI和SATA的稳定性 Feb 12th, 2008 最近看到一篇文章讨论SATA和SCSI硬盘的可靠性问题。这篇文章的结论是：两种硬盘的故障率（MTBF）是极其接近的，只不过便宜的SATA硬盘要比昂贵的SCSI硬盘的误码率（BER）要高得多。也就是说，出现某个sector无法读取的情况， &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://lenciel.cn/docs/scsi-sata-reliability/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/github/lenciel" rel="alternate" title="@Lenciel" type="application/atom+xml">
  <!-- Facebook Open Graph
     Facebook Debugger: https://developers.facebook.com/tools/debug -->
<meta property="og:title" content="SCSI和SATA的稳定性" /><meta itemprop="name" content="SCSI和SATA的稳定性" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://lenciel.cn/docs/scsi-sata-reliability/" />
<meta property="og:description" content="SCSI和SATA的稳定性 Feb 12th, 2008 最近看到一篇文章讨论SATA和SCSI硬盘的可靠性问题。这篇文章的结论是：两种硬盘的故障率（MTBF）是极其接近的，只不过便宜的SATA硬盘要比昂贵的SCSI硬盘的误码率（BER）要高得多。也就是说，出现某个sector无法读取的情况， &hellip;" />

<meta property="og:site_name" content="http://lenciel.cn" />
<meta property="article:author" content="https://plus.google.com/114787528537231301324">
<meta property="article:published_time" content="2008-02-12 09:35" />


<meta itemprop="description" content="SCSI和SATA的稳定性 Feb 12th, 2008 最近看到一篇文章讨论SATA和SCSI硬盘的可靠性问题。这篇文章的结论是：两种硬盘的故障率（MTBF）是极其接近的，只不过便宜的SATA硬盘要比昂贵的SCSI硬盘的误码率（BER）要高得多。也就是说，出现某个sector无法读取的情况， &hellip;" />

<!-- Combine multiple fonts into one request -->
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic|Patua+One|Yanone+Kaffeesatz" rel="stylesheet" type="text/css">
<!-- jQuery -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>

  <script>
  !function(g,s,q,r,d){r=g[r]=g[r]||function(){(r.q=r.q||[]).push(
  arguments)};d=s.createElement(q);q=s.getElementsByTagName(q)[0];
  d.src='//d1l6p2sc9645hc.cloudfront.net/tracker.js';q.parentNode.
  insertBefore(d,q)}(window,document,'script','_gs');

  _gs('GSN-360316-J');
</script>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-175991-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">@Lenciel</a></h1>
  
    <h2>Thoughts and Rants.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/github/lenciel" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:lenciel.cn" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/"><i class="icon-home"></i>Home</a></li>
  <li><a href="/blog/archives"><i class="icon-book-alt"></i>Archives</a><span class="divider"></span></li>
  <li><a href="/about"><i class="icon-user"></i>About</a><span class="divider"></span></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article role="article">
  
  <header>
    <h1 class="entry-title">SCSI和SATA的稳定性</h1>
    <p class="meta">








  


<time datetime="2008-02-12T09:35:00+08:00" pubdate data-updated="true">Feb 12<span>th</span>, 2008</time></p>
  </header>
  
  <p>最近看到<a href="http://permabit.wordpress.com/2008/08/20/are-fibre-channel-and-scsi-drives-more-reliable/" target="_blank">一篇文章</a>讨论SATA和SCSI硬盘的可靠性问题。这篇文章的结论是：两种硬盘的故障率（<a href="http://en.wikipedia.org/wiki/MTBF" target="_blank">MTBF</a>）是极其接近的，只不过便宜的SATA硬盘要比昂贵的SCSI硬盘的<strong>误码率（<a href="http://en.wikipedia.org/wiki/Bit_error_ratio" target="_blank">BER</a>）要高得多。</strong>也就是说，出现某个sector无法读取的情况，SATA要比SCSI严重得多。按照他的计算，一个1TB的硬盘，通常你无法读取所有sector的概率达到了56%，因此你在出现硬盘故障的情况下重建RAID的希望是：<strong>无法实现</strong>。 </p>

<p>的确如此，在过去，一般RAID的磁盘容量都不大，比如20GB，无法恢复一个RAID的概率按照文献是1.1% <sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>。 
当硬盘容量上升到200GB，假设出现故障的概率是线性增长的 <sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup>
，那么失败率就会有11%：估计负责存储的人就会被老板操的厉害了。 </p>

<h2 id="section">硬盘故障</h2>

<p>一般不是很注意用磁盘工具看自己硬盘坏道的同学对IDE接口的硬盘有这样的概念：这个硬盘要么就一帆风顺的工作着，要么就是怎么修复也已经治不好的。也就是说如果硬盘挂几个sector如果你不注意其实根本感觉不到，一定是0道挂了才知道自己中招了。</p>

<p>这种体验其实是因为现在的硬盘都有<a href="http://en.wikipedia.org/wiki/Bad_sector">spare sector remapping</a>技术，可以自动检测出一般的坏道，然后停止使用它们。但是这项技术的缺陷是，必须在“写”操作的时候，才能进行检测：你往里面写东西完毕后，会立刻读取出来进行校验，如果校验失败，就会写到冗余的磁道去，并停止使用当前坏道。但是当你读取内容时，校验失败呢？ </p>

<h2 id="section-1">误码率</h2>

<p>读取内容时出错的概率就是“误码率”描述的问题。现代硬盘可以保证你写进去的东西马上再读的时候是没有问题的，但是数据还是可以在某年某月某日的读取中丢失。这种事情的概率（per bit）从来没有随着硬盘技术的进步降低：因为SCSI硬盘的容量一般比过去的SATA硬盘要大很多。</p>

<p>但是开头提到的那篇文章里面说有56%，这个数据还是显得有些“不可信”。大概是因为下面两个原因，我们才没有怎么听说过这么高的BER吧。 </p>

<p>首先，我们自己用的硬盘都不会跑RAID。虽然现在我们自己的硬盘容量也变得很大（本座有个500G的移动硬盘拿来放电影和音乐），但是这个量级的硬盘上面大多数数据你都很少去读取它。因此从概率上讲，坏道出现在那些没卵味的电影和音乐上的可能性大很多，而<strong>大多数电影和音乐都没卵味</strong>。 </p>

<p>但是对于跑RAID的用户，对整个硬盘进行读取的事情经常发生。即使系统足够和谐，知道不向你报告那些出现在你从不读取的文件中的坏道，但是也只是略过了报告这一步：它还是会找到所有的坏道，56%就来了。 </p>

<p>其次，虽然你丢了一些sector，一般情况下也没啥关系。还是以电影和音乐为例，大多数的压缩算法都从设计上允许有一些这样或者那样的误码。丢了几个sector的数据，也许对你来说就是松岛枫身上的马赛克变厚了一些而已，你都不知道是硬盘作祟。 </p>

<h2 id="section-2">怎么办</h2>

<p>如果你的硬盘里面放了重要的东西，你又没有跑RAID，出现了错误数据怎么恢复？本座好像还没有听说过可以直接化解这种问题的办法，所以大概定期的增量备份是不可缺少的：备份，备份，备份！ </p>

<p>而在RAID上面的话，问题就要简单一些：你只需要在硬盘故障之前找出坏道。最好每个星期，你都对所有的sector内容进行一次读取。如果你的RAID是好的，但是检测出了坏道，你就可以先用RAID将坏道的内容重建出来，然后再写到有问题的硬盘里面去：这个时候前面说的sector remapping代码就会把坏的sector永远屏蔽了。 </p>

<p>这种读取-重建的代码从来没有开放过，你必须自己编码才能实现。不过，我们有<a href="http://linux.die.net/man/1/ionice" target="_blank">ionice</a>可以调用，实现起来不会太难。 </p>

<p>还有一个关键问题就是你要确定你的RAID软件支持在个别坏道被发现时能够恢复。比如Linux 2.4的RAID代码就和我们过去的假设一样：一个硬盘挂了，它就是无法恢复的彻底挂了。于是这个硬盘被立刻移出RAID，直到你换一个新的硬盘。问题是现代的硬盘容量如此之大，每个硬盘都可能会有坏道，于是根据这种假设去重建RAID变得没有可能。而且，扔掉一个磁盘是做存储的人最不想听到的结果：你连恢复它的可能性都没有了。 </p>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>注意，1.1%已经很不错了，因为你在硬盘故障之后，才需要去恢复RAID。两个概率是要相乘的，如果你知道本座在说什么的话<a href="#fnref:1" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p>当然，线性增长的这个假设是错误的。我们可以做一个计算：1TB的故障率是56%的话，无故障率是1-0.56=0.44。把一个1TB硬盘划成50X20GB的数据块。整个硬盘无故障也就是每个 数据块没故障，因此每个数据块无故障率应该是0.44的50次方根，大概是98.4%。那20GB的故障率大概是1-98.4%=1.6%左右，而不是1.1%。<a href="#fnref:2" rel="reference">&#8617;</a></p>
    </li>
  </ol>
</div>

  
    <footer>
      <p class="meta">
        
        








  


<time datetime="2008-02-12T09:35:00+08:00" pubdate data-updated="true">Feb 12<span>th</span>, 2008</time>
        
      </p>
      
        <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://lenciel.cn/docs/scsi-sata-reliability/index.html" data-via="" data-counturl="http://lenciel.cn/docs/scsi-sata-reliability/index.html" >Tweet</a>
  
  
  
  <!-- JiaThis Button BEGIN -->
  <div class="jiathis_style_24x24">
    <a class="jiathis_button_qzone"></a>
    <a class="jiathis_button_tsina"></a>
    <a class="jiathis_button_tqq"></a>
    <a class="jiathis_button_weixin"></a>
    <a class="jiathis_button_renren"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
    <a class="jiathis_counter_style"></a>
  </div>
  <script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
  <!-- JiaThis Button END -->
</div>

      
    </footer>
  
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    
  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Lenciel Li<span class="theme-version">Octopress-Lenciel 0.1</span>
  <section class="contruction-wrap">
    <div class="contruction"></div>
  </section>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'lencielgithub';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://lenciel.cn/docs/scsi-sata-reliability/index.html';
        var disqus_url = 'http://lenciel.cn/docs/scsi-sata-reliability/index.html';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>



<!--














                                            IIIIIIIIII       I
                  II                     IIIIIIIIIIIIIIIIIIII
                  IIII                  IIIIIIIIIIIIIIIIIIII
                  IIIIII                IIIIIIIIIIIIIIIIII III
                  IIIIIIII             IIIIIIIIIIIIIIIIIIIIII
                  IIIIIIIIIII          IIIIIIIIIIIIIIIIIIIII
                  IIIIIIIIIIIIII       IIIIIIIIIIIIIIIIIII
                   IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                  I  IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                  IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                  IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                   IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                    IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                     IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                         IIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                     IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                      IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                        IIIIIIIIIIIIIIIIIIIIIIIIIIIII
                           IIIIIIIIIIIIIIIIIIIIIIIII
                             IIIIIIIIIIIIIIIIIIIII
                          IIIIIIIIIIIIIIIIIIIIIII
                I   IIIIIIIIIIIIIIIIIIIIIIIIII
                  IIIIIIIIIIIIIIIIIIIIIIIIII
                      IIIIIIIIIIIIIIIIII















 -->


</body>
</html>
