
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>@Lenciel</title>
  <meta name="author" content="Lenciel Li">

  
  <meta name="description" content="连某宝都中招的Heartbleed bug究竟是个什么东西？简单地说就是攻击者可以读最多64KB内存的内容。 读了这64KB能干嘛？用报这个bug的人的话来说： Without using any privileged information or credentials we were able &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://lenciel.cn/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/github/lenciel" rel="alternate" title="@Lenciel" type="application/atom+xml">
  <!-- Facebook Open Graph
     Facebook Debugger: https://developers.facebook.com/tools/debug -->

<meta property="og:type" content="article" />
<meta property="og:url" content="http://lenciel.cn/" />
<meta property="og:description" content="连某宝都中招的Heartbleed bug究竟是个什么东西？简单地说就是攻击者可以读最多64KB内存的内容。 读了这64KB能干嘛？用报这个bug的人的话来说： Without using any privileged information or credentials we were able &hellip;" />

<meta property="og:site_name" content="http://lenciel.cn" />
<meta property="article:author" content="https://plus.google.com/114787528537231301324">



<meta itemprop="description" content="连某宝都中招的Heartbleed bug究竟是个什么东西？简单地说就是攻击者可以读最多64KB内存的内容。 读了这64KB能干嘛？用报这个bug的人的话来说： Without using any privileged information or credentials we were able &hellip;" />

<!-- Combine multiple fonts into one request -->
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic|Patua+One|Yanone+Kaffeesatz" rel="stylesheet" type="text/css">
<!-- jQuery -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>

  <script>
  !function(g,s,q,r,d){r=g[r]=g[r]||function(){(r.q=r.q||[]).push(
  arguments)};d=s.createElement(q);q=s.getElementsByTagName(q)[0];
  d.src='//d1l6p2sc9645hc.cloudfront.net/tracker.js';q.parentNode.
  insertBefore(d,q)}(window,document,'script','_gs');

  _gs('GSN-360316-J');
</script>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-175991-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">@Lenciel</a></h1>
  
    <h2>Thoughts and Rants.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/github/lenciel" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:lenciel.cn" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/"><i class="icon-home"></i>Home</a></li>
  <li><a href="/blog/archives"><i class="icon-book-alt"></i>Archives</a><span class="divider"></span></li>
  <li><a href="/about"><i class="icon-user"></i>About</a><span class="divider"></span></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2014/04/openssl-heartbleed-bug/">Openssl Heartbleed Bug</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-10T11:29:15+08:00" pubdate data-updated="true">Apr 10<span>th</span>, 2014</time>
        
         | <a href="/2014/04/openssl-heartbleed-bug/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>连某宝都中招的<a href="http://heartbleed.com/">Heartbleed bug</a>究竟是个什么东西？简单地说就是攻击者可以读最多64KB内存的内容。</p>

<p>读了这64KB能干嘛？用报这个bug的人的话来说：</p>

<blockquote><p>Without using any privileged information or credentials we were able steal from ourselves the secret keys used for our X.509 certificates, user names and passwords, instant messages, emails and business critical documents and communication.</p></blockquote>

<p>那么读取64KB内存和获取这么多关键信息究竟有什么关系呢？</p>

<h2 id="the-bug">The bug</h2>
<p>先来看看<a href="http://git.openssl.org/gitweb/?p=openssl.git;a=commitdiff;h=96db9023b881d7cd9f379b0c154650d6c108e9a3">patch</a>里面的<code>ssl/d1_both.c</code>:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="c"><span class="line"><span class="kt">int</span>
</span><span class="line"><span class="nf">dtls1_process_heartbeat</span><span class="p">(</span><span class="n">SSL</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span>
</span><span class="line">    <span class="p">{</span>
</span><span class="line">    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">s3</span><span class="o">-&gt;</span><span class="n">rrec</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">*</span><span class="n">pl</span><span class="p">;</span>
</span><span class="line">    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">hbtype</span><span class="p">;</span>
</span><span class="line">    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">payload</span><span class="p">;</span>
</span><span class="line">    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">padding</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span> <span class="cm">/* Use minimum padding */</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>可以看到，heartbeat里有一个 <a href="http://en.wikipedia.org/wiki/Transport_Layer_Security">SSLv3</a>  record的指针，这个<code>record</code>的代码如下:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="c"><span class="line"><span class="k">typedef</span> <span class="k">struct</span> <span class="n">ssl3_record_st</span>
</span><span class="line">    <span class="p">{</span>
</span><span class="line">        <span class="kt">int</span> <span class="n">type</span><span class="p">;</span>               <span class="cm">/* type of record */</span>
</span><span class="line">        <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">length</span><span class="p">;</span>    <span class="cm">/* How many bytes available */</span>
</span><span class="line">        <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">off</span><span class="p">;</span>       <span class="cm">/* read/write offset into &#39;buf&#39; */</span>
</span><span class="line">        <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span>    <span class="cm">/* pointer to the record data */</span>
</span><span class="line">        <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">input</span><span class="p">;</span>   <span class="cm">/* where the decode bytes are */</span>
</span><span class="line">        <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">comp</span><span class="p">;</span>    <span class="cm">/* only used with decompression - malloc()ed */</span>
</span><span class="line">        <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epoch</span><span class="p">;</span>    <span class="cm">/* epoch number, needed by DTLS1 */</span>
</span><span class="line">        <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">seq_num</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span> <span class="cm">/* sequence number, needed by DTLS1 */</span>
</span><span class="line">    <span class="p">}</span> <span class="n">SSL3_RECORD</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>可以看到，每个<code>record</code>有它的<code>type</code>、<code>length</code>和<code>data</code>，规规矩矩。</p>

<p>回到<code>dtls1_process_heartbeat</code>：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="c"><span class="line"><span class="cm">/* Read type and payload length first */</span>
</span><span class="line"><span class="n">hbtype</span> <span class="o">=</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">;</span>
</span><span class="line"><span class="n">n2s</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">payload</span><span class="p">);</span>
</span><span class="line"><span class="n">pl</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>可以看到<code>SSLv3 record</code>的第一个byte就是放这个<code>heartbeat</code>的<code>type</code>。 宏<code>n2s</code> 则是从<code>p</code>里面取两个byte放到payload里面，被用来作为payload的长度。 <strong>注意这里并没有检查<code>SSLv3 record</code> 实际的长度。</strong> </p>

<p>接下来在这个函数里面干了下面这些事情：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="c"><span class="line"><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="o">*</span><span class="n">bp</span><span class="p">;</span>
</span><span class="line"><span class="kt">int</span> <span class="n">r</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="cm">/* Allocate memory for the response, size is 1 byte</span>
</span><span class="line"><span class="cm"> * message type, plus 2 bytes payload length, plus</span>
</span><span class="line"><span class="cm"> * payload, plus padding</span>
</span><span class="line"><span class="cm"> */</span>
</span><span class="line"><span class="n">buffer</span> <span class="o">=</span> <span class="n">OPENSSL_malloc</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">payload</span> <span class="o">+</span> <span class="n">padding</span><span class="p">);</span>
</span><span class="line"><span class="n">bp</span> <span class="o">=</span> <span class="n">buffer</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>可以看到，用户要多少程序就分配多少，最多可以分配到<code>65535+1+2+16</code>，指针bp被用来操作这块内存。然后：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="c"><span class="line"><span class="cm">/* Enter response type, length and copy payload */</span>
</span><span class="line"><span class="o">*</span><span class="n">bp</span><span class="o">++</span> <span class="o">=</span> <span class="n">TLS1_HB_RESPONSE</span><span class="p">;</span>
</span><span class="line"><span class="n">s2n</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">bp</span><span class="p">);</span>
</span><span class="line"><span class="n">memcpy</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">pl</span><span class="p">,</span> <span class="n">payload</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>宏<code> s2n</code>把<code>n2s</code>做的操作恢复出来：先拿16个bit的值放到2个byte里面，也就是原来请求的payload的长度。然后把<code>pl</code>里面放的payload(请求者提交的data)拷贝到新分配的<code>bp</code>里面。</p>

<p>看起来是很平常的操作，只不过没有认真的检查用户输入而已，但问题也就在这里了。</p>

<h2 id="where-is-the-bug">Where is the bug</h2>

<p>如果用户并没有正在提交声称的那么多个bytes的payload，那么memcpy就会读到同一个process里面SSLv3 record附近的内存内容。</p>

<p>这附近有哪些内容呢？</p>

<p>首先要明白在linux上，内存的动态分配主要是通过<a href="http://linux.die.net/man/2/sbrk">sbrk</a> 或者是 <a href="http://man7.org/linux/man-pages/man2/mmap.2.html">mmap</a>。如果内存是通过sbrk分配的，它会使用<code>heap-grows-up</code>规则，泄露出来的东西不会那么多（但是如果是同时并发请求<a href="http://blog.existentialize.com/diagnosis-of-the-openssl-heartbleed-bug.html#fn:update">还是有东西会漏</a>）。</p>

<p>在这里，<code>pl</code>因为malloc里面的mmap_threshhold多半是sbrk分配的，但是，那些关键的用户数据，则多半是通过mmap分配内存。于是这些数据就会被攻击者用<code>pl</code>拿到。如果再考虑并发请求，就…</p>

<h2 id="the-fix">The fix</h2>

<p>所以，整个patch里面最主要的fix就是：
* 检查是否有长度为0的虚假heartbeat
* 检查record的真实长度</p>

<p>代码如下：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="c"><span class="line"><span class="cm">/* Read type and payload length first */</span>
</span><span class="line"><span class="k">if</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">16</span> <span class="o">&gt;</span> <span class="n">s</span><span class="o">-&gt;</span><span class="n">s3</span><span class="o">-&gt;</span><span class="n">rrec</span><span class="p">.</span><span class="n">length</span><span class="p">)</span>
</span><span class="line">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="cm">/* silently discard */</span>
</span><span class="line"><span class="n">hbtype</span> <span class="o">=</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">;</span>
</span><span class="line"><span class="n">n2s</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">payload</span><span class="p">);</span>
</span><span class="line"><span class="k">if</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">payload</span> <span class="o">+</span> <span class="mi">16</span> <span class="o">&gt;</span> <span class="n">s</span><span class="o">-&gt;</span><span class="n">s3</span><span class="o">-&gt;</span><span class="n">rrec</span><span class="p">.</span><span class="n">length</span><span class="p">)</span>
</span><span class="line">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="cm">/* silently discard per RFC 6520 sec. 4 */</span>
</span><span class="line"><span class="n">pl</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="so">So?</h2>

<p>这个bug大概算是影响这么剧烈的bug里面最好明白的一个，所以居然我也看明白了。感受：</p>

<ul>
  <li>为了可扩展性引入了复杂度，经常都会带来恶梦</li>
  <li>用户的输入，无论如何都不能相信，一定要check</li>
  <li>C语言的确是大牛小牛都会踩到坑啊</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2014/04/why-made-apps/">应用开发能火多久?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-09T15:07:57+08:00" pubdate data-updated="true">Apr 9<span>th</span>, 2014</time>
        
         | <a href="/2014/04/why-made-apps/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>不管是从日常生活里面的观察和感受，还是查看统计数据，都很容易发现人们在移动设备上停留的时间已经逐渐超过了在PC上停留的时间。当然拐点是不是如下图所示就在今年业界有些争议，但是拐点已经要来了是没有人再怀疑了。</p>

<p><img src="/downloads/images/2014_04/comscore_mobile_users_desktop_users_2014.jpg" alt="mobile vs desktop" title="Don't touch me..." /></p>

<p>而移动设备取代PC机成为最主要的入口之后，就意味着谁占领了移动设备，谁就拥有未来。同样不管是从切身体会还是数据都不难知道，和PC上各种网站（包括各种浏览器+插件提供的服务）占据统治地位不同，在移动平台上，应用程序获得了全面的胜利。</p>

<p><img src="/downloads/images/2014_04/apps_dominate_hires.png" alt="mobile apps vs website" title="Don't touch me..." /></p>

<p>移动客户端上网站和App相比所处的劣势会越来越严重。无论是我们自己公司还是行业内其他人，都知道做移动互联网就是要做应用才行。所以你看手机网页上和游戏里，各种弹窗、各种广告、各种骚扰短信，都是指向某个应用的下载链接。</p>

<p>这也是为什么那么多财大气粗的实体官方的网站在移动客户端上看起来就跟狗屎一样：他们的老板们的逻辑和开发者一样，那些网站没什么人在手机上看，只要我的应用、我的微信公众号看起来好就行了。</p>

<p>这么一来，最好的开发和设计人员都去做应用了，大量的钱也都烧在应用推广上去了。</p>

<p>最终我们手机上的浏览器几乎被闲置了，打开它主要是为了：</p>

<ul>
  <li>搜索</li>
  <li>下载一个应用</li>
  <li>从一些sns程序里面点开某个链接</li>
</ul>

<p>而且，就第三项用处来看，越来越多的sns程序，比如微信，微博等，都是直接在自己内嵌的webview里面打开链接，根本不会使用系统安装的浏览器。</p>

<p>从长远看这种应用一骑绝尘网站无人问津的状况还是对整个生态有很大的风险：</p>

<ul>
  <li>看看有线电视发展到后面是什么样：大寡头们有更好的设备，更强大的制作班底，更多的明星，控制了整个行业。这种状况下，用户打开电视能看到什么样的节目几乎没得选，小团队要靠创新来出头也变得非常困难</li>
  <li>应用主要在少数几个主流应用商店发行，比如Google和Apple的。意味着Google和Apple不仅仅要抽水，还要对应用内容，应用怎么推广，甚至应用用什么语言开发进行控制。</li>
</ul>

<p>比如Apple。在PhoneGap最开始出来的时候，所有用这个hybrid framework开发的应用都被Apple强制封杀，理由居然是“不使用native library开发的应用不像一个应用”。再比如最近，它直接发了一个policy就让所有跟BT币有关的应用下架了。</p>

<p>感觉在移动平台上会上演类似PC上的历史，首先会有Apple和Google这样提供OS的企业通过应用这个渠道来做成大山头。然后生态系统对其他参与者越来越艰辛，于是会有很多企业尝试破冰，比如通过开发功能强大的浏览器形成新的渠道，来脱离寡头们的控制。最终，移动平台上的浏览器肯定也会像现在PC上的浏览器一样强大，成为各种服务的入口。</p>

<p>而且，这个过程肯定会比PC上要快很多。首先，大家都已经被教育过一次了，大腾讯大百度们做自己的浏览器不是做着玩的；更重要的是，Web发展到今天这个地步，开放性已经有些脱离技术，变成了社会生活中的一种意识形态。一旦移动网络资费和速度真正给力，肯定会有揭竿而起的。即使大如Google和Apple，也很难再像当年MS那样hold住全场了。那个时候，很多Myriad这样的做中间件的公司，又会春风得意了吧。</p>

<p>当然，最近这些年肯定还是应用开发热火的时候，小伙伴们，过时不候，放手干吧。</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2014/04/pomodoroda-tech/">Pomodoro Technique</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-03T13:44:35+08:00" pubdate data-updated="true">Apr 3<span>rd</span>, 2014</time>
        
         | <a href="/2014/04/pomodoroda-tech/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/downloads/images/2014_04/pomodoro_tech.jpg" alt="Pomodoro Technique" title="Don't touch me..." /></p>

<p>时间管理对每个人都是非常重要的，相关的理论和工具都有很多。本座试过很轻量的<a href="https://github.com/vim-scripts/todolist.vim">todolist.vim</a>，也试过很大气的<a href="https://www.omnigroup.com/omnifocus">OmniFocus</a>，但可能和自己比较爱随意乱来的性格，这些工具最终都被本座慢慢荒弃。</p>

<p>倒是从E公司就一直用到现在的<a href="http://pomodorotechnique.com">Pomodoro Technique</a><sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>，因为规则简单上手迅捷疗效明显，最终成为了日常生活的一部分。</p>

<h2 id="section">起</h2>

<p>Francesco Cirillo在1992年正式提出了<code>Pomodoro Technique</code>，命名似乎来源于手边的番茄形状的烹调定时器。简单的说，Pomodoro就是：</p>

<ul>
  <li>一天开始的时候规划今天要完成的几项任务</li>
  <li>设定你的番茄钟（软件、闹钟、whatever），时间是25分钟</li>
  <li>开始完成第一项任务，直到番茄钟响铃或提醒</li>
  <li>停止工作，休息3~5分钟</li>
  <li>开始下一个番茄钟，继续该任务。一直循环下去，直到完成该任务，并在列表里将该任务划掉。</li>
  <li>如此这般完成今天所有的事情。</li>
  <li>每四个番茄钟后，休息25分钟。</li>
</ul>

<p>在工作的25分钟周期里面，什么样的中断都置之不理当然是最好的。但如果有中断进来：</p>

<ul>
  <li>非得马上做不可的话，停止当前这个番茄钟并宣告它作废（哪怕还剩5分钟就结束了），完成带来中断的事情，之后再重新开始同一个番茄钟；</li>
  <li>不是必须马上去做的话，将带来中断的事情记在另一个列表里（比如叫”Exception”或者”Unplanned”什么的），然后接着完成这个番茄钟。</li>
</ul>

<p>接下来，一天结束的时候，你可以回忆一下今天完成了几个钟，并且反思：</p>

<ul>
  <li>你受到了哪些中断？</li>
  <li>你最能集中注意力的地方是哪里？</li>
  <li>你如何避免开始做一个无趣的工作？</li>
  <li>什么类型的活动会花去超过你估计的时间？</li>
  <li>你是否因为处理管理性质的事务而没时间做该做的事情？</li>
</ul>

<h2 id="section-1">承</h2>

<p>为什么这种办法是有效的呢？个人觉得主要是两方面的原因。</p>

<h3 id="section-2">心理层面</h3>

<h4 id="section-3">分解过的任务更具体</h4>

<p>我们做一件事情，复杂度太高的话，兴奋度就会降低，你就会选择拖延。一件事情在被分解成很小的部分之后，才会变得清晰。甚至在操作中，如果你一个任务需要7、8个钟都迭代不完，你可能还应该把这件事情先分解成更小的子任务。</p>

<h4 id="section-4">分解过的任务更可控</h4>

<p>休息和工作之间的心境切换起来很难。有时候你来上班或者吃过饭之后，要进入真正做事的状态花的时间会比你想象的要多很多。番茄大法是动作导向的：上好闹钟。订好提示音，可以让你更好控制自己。</p>

<p>完美主义也是妨碍你按时完成任务的一大原因。想出一个完美的解决方案，那不就是拖延么？在Pomodoro大法中有很多迭代开发的禅意：你不能用25分钟内的时间去考虑完美的方案，乖乖上好闹钟，完成25分钟的任务，然后5分钟休息时间里面去想那些改进的方案吧。</p>

<h4 id="section-5">分解过的任务更有趣</h4>

<p>如果任务无趣时，拖延的时间会增加。比如做项目做到最后的收尾工作之类时，常常非常无趣。分解它们，让你知道你多快就能完成它，可以激励自己。</p>

<p>别人催你完成你不想完成的事情时，你多半也做不好。”have-to”和”want-to”之间的矛盾简直就是<a href="http://en.wikipedia.org/wiki/Terrible_twosX">the-terrible-two</a>终生梦魇版。通过使用番茄大法，你每天确信自己能够完成的事情能够做到心中有数。</p>

<h3 id="section-6">生理层面</h3>

<p>如果你常看球赛的话，就会知道一些关于<strong>模式</strong>的八卦。</p>

<p>比如穆图为多家球队效力都表现不错，对于这种成功他解释说：“诅咒对我是无效的，因为我总是把内裤穿在外面。”</p>

<p>约翰特里，切尔西的队长，国家队的中坚，问下他怎么做到集中精力？他会告诉你他每次比赛前都听同一张CD，在同一个地方停车，把鞋带系三次。</p>

<p>我大学球队的主教练，从来不许老婆和女儿坐进替补席。</p>

<p>我们的大脑在一定环境下，会进入某种模式，处理某些问题特别迅速。这种受后天训练得到的反应是Conditioned Reflexes（条件反射）。而简短且固定的专注时间，可以训练你进入这种模式。</p>

<h2 id="section-7">转</h2>

<p>Pomodoro说到底是一种轻量的<a href="http://zh.wikipedia.org/wiki/GTD">GTD</a>规则。</p>

<p>如果是工作内容高度碎片化的人，比如高管，其实是没法做到动不动就入定30分钟不理人间事的。</p>

<p>如果是对创意要求很高的工种，比如画家，作家，好像也不太适合这种非常规律的迭代。</p>

<h2 id="section-8">合</h2>

<p>拿出纸笔，写下你很想完成的一些事情。从里面挑一个最重要的，你最想马上完成的。然后：</p>

<ol>
  <li>定一个10分钟的闹钟</li>
  <li>集中精力完成</li>
  <li>当闹钟到时立刻停止</li>
  <li>休息三分钟</li>
</ol>

<p>结果怎样？你多久看一次闹钟？有没有被其他事情打断？</p>

<p>如果觉得10分钟自己能轻松搞定，就可以慢慢延长这个时间了。有不少软件可以帮助你自由的定时和统计：</p>

<ul>
  <li><a href="https://fnd.io/#/search?mediaType=all&amp;term=Pomodoro">iOS应用</a></li>
  <li><a href="http://www.publicspace.net/Vitamin-R/index.html">Mac应用</a></li>
  <li><a href="http://www.focusboosterapp.com/">Windows应用</a></li>
</ul>

<p>各种浏览器插件那就不说了满坑满谷都是。</p>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>http://pomodorotechnique.com/。<a href="#fnref:1" rel="reference">&#8617;</a></p>
    </li>
  </ol>
</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2014/04/time-to-talk-about-math/">勾股定理</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-02T14:30:00+08:00" pubdate data-updated="true">Apr 2<span>nd</span>, 2014</time>
        
         | <a href="/2014/04/time-to-talk-about-math/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>这篇日志主要是想试试:</p>

<ul>
  <li>怎么把<code>d3.js</code>和<code>AngularJS</code>集成到<a href="http://lenciel.cn/2013/03/blog-with-octopress-and-github-pages/">octopress</a>，因为<a href="http://vudlab.com/bart/">setosa</a>很酷</li>
  <li>怎么在某篇日志里面支持specific的js和css</li>
</ul>

<p>玩了一下并不是很麻烦，于是这个静态站点可以干的事情就”动态”多了。比如把课本里面的<a href="http://aleph0.clarku.edu/~djoyce/java/elements/bookI/propI47.html">勾股定理</a>通过画图证明一下(点击黑色背景字母有彩蛋)：</p>

<link rel="stylesheet" type="text/css" href="/downloads/static/css/math_d3_angular.css" />

<script src="/downloads/static/js/d3.min.js" charset="utf-8"></script>

<script src="/downloads/static/js/angular.min.js" charset="utf-8"></script>

<script src="/downloads/static/js/math_d3_angular.js" charset="utf-8"></script>

<div class="main-content" ng-app="app" ng-controller="MainCtrl" ng-style="styles.content" ng-class="{ sm : w &lt; 650 }" ng-init="init()">
    <div id="panel1" class="panel" ng-style="styles.panel1">
      <stage selected-shape="selectedShape" ng-mouseover="selectedShape = null" />
    </div>
    <div id="panel2" class="panel" ng-style="styles.panel2">
      <div class="details">
        <p>
          如图所示的三角形<co points="abc" shape="triangle">ABC</co>角<co points="bac" shape="angle">BAC</co>为直角。
        </p>
        <p>
          勾股定理是说<co points="bdec" shape="square">BC</co>的平方等于<co points="abfg" shape="square">BA</co>的平方加上<co points="ackh" shape="square">AC</co>的平方。证明如下:
        </p>
        <p>
          把<co points="bc" shape="line">BC</co>的平方对应的正方形简称为<co points="bdec" shape="square">CD</co>，同理<co points="ba" shape="line">BA</co>和
          <co points="ac" shape="line">AC</co>的平方分别对应
<co points="abfg" shape="square">GB</co>和<co points="ackh" shape="square">HC</co>
画与<co points="bd" shape="line">BD</co>和<co points="ce" shape="line">CE</co>平行的直线<co points="al" shape="line">AL</co>，然后连接<co points="ad" shape="line">AD</co>和<co points="fc" shape="line">FC</co>。
        </p>
        <p>因为角<co points="bac" shape="angle">BAC</co>
          和角<co points="bag" shape="angle">BAG</co>
          都是直角，所以<co points="ca" shape="line">CA</co>
          和<co points="ag" shape="line">AG</co>在同一条直线上。
        </p>
        <p>
          同理，<co points="ba" shape="line">BA</co>
          和<co points="ah" shape="line">AH</co>也在一条直线上。
        </p>
        <p>
          又由角<co points="dbc" shape="angle">DBC</co>
          和角<co points="fba" shape="angle">FBA</co>
          都是直角，因此它们加上<co points="abc" shape="angle">ABC</co>
          得到的角<co points="dba" shape="angle">DBA</co>
          和<co points="fbc" shape="angle">FBC</co>相等。
        </p>
        <p>
          再由<co points="db" shape="line">DB</co>
          等于<co points="bc" shape="line">BC</co>,
          且<co points="fb" shape="line">FB</co>
          等于<co points="ba" shape="line">BA</co>,
          可得三角形<co points="abd" shape="triangle">ABD</co>面积等于三角形
          <co points="fbc" shape="triangle">FBC</co>。
        </p>

        <p>又由
          <co points="bd" shape="line">BD</co>和
          <co points="al" shape="line">AL</co>平行，所以同底的矩形<co points="bvld" shape="square">BL</co>的面积是三角形
          <co points="abd" shape="triangle">ABD</co>的面积的2倍。同理正方形<co points="gfba" shape="square">GB</co>的面积是三角形<co points="fbc" shape="triangle">FBC</co>面积的两倍。
        </p>

        <p>于是可得矩形<co points="bvld" shape="square">BL</co>面积等于<co points="gfba" shape="square">GB</co>。
        </p>

        <p>同理将
          <co points="ae" shape="line">AE</co>
和<co points="bk" shape="line">BK</co>
连接起来,可证矩形<co points="cvle" shape="square">CL</co>面积等于正方形<co points="hack" shape="square">HC</co>。于是可得正方形<co points="bdec" shape="square">CD</co>
面积等于正方形<co points="gfba" shape="square">GB</co>与<co points="hack" shape="square">HC</co>的和。
        </p>

        <p>这也就证明了
          <co points="bc" shape="line">BC</co>
          的平方等于<co points="ba" shape="line">BA</co>
          的平方加上
          <co points="ac" shape="line">AC</co>的平方。
        </p>
      </div> <!-- end details -->
    </div> <!-- end panel -->
</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2014/03/good-night-1/">晚安(二)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-03-10T06:18:00+08:00" pubdate data-updated="true">Mar 10<span>th</span>, 2014</time>
        
         | <a href="/2014/03/good-night-1/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img alt="block" src="/downloads/images/2014_03/good_night.jpg" align="left" style="margin:0px 5px;width:23%" />  而我每年用掉一些暑假(后来工作了就是年假)陪着外公去兰州，当然不是因为我是影视作品里常常出现的那种孝顺贴心的孙子。事实上即使在父母分开生活之前，我和外公之间也没有太多的交流，是兰州这个地方把我们联系在了一起：不过，你猜错了，并不是什么我爱的人也在这里。</p>

<p>只不过是那趟火车会路过她在的城市，我可以坐在车窗边，对着那个陌生的城市无所顾忌地想着她，如此而已。</p>

<p>“那是个什么样的姑娘？” 终于有一次外公大概觉得自己的事情已经聊完，就漫不经心地问到。</p>

<p>“很明显吗？”</p>

<p>“未必明显。其实正好相反，你小子要藏起来的东西，别人大概很难发现。不过对我怎么可能瞒得住，不要忘了，第一，我比你还能藏；第二，你是我带大的。”</p>

<p>“哦？”</p>

<p>“你小时候每天晚上都很吵。你妈受不了的时候，我就抱着你到阳台上把你拍睡着。”</p>

<p>“好像听我妈说过，经常拍到半夜，辛苦你了。”</p>

<p>“但其实没觉得多累。一方面享受着你到来的欢乐，一方面，也享受着可以让自己胡思乱想的安宁空间。如果拍张照片，估计跟你刚才的表情一样。”</p>

<p>“可能是吧，呵呵。” 我嘴上应着，心里却想，”我可没有你那么多值得回忆的事情撑得起每晚都跑去胡思乱想。”</p>

<p>“放心吧，我不会告诉你妈的。”</p>

<p>这点我相信。密闭的车厢让人们成为莫名其妙的朋友，几次兰州之行后，我和外公也不例外。</p>

<p>“但没有什么好说的，没有什么长发飘飘也没有什么白裙飘飘，只是偶尔会想起她。”</p>

<p>“想什么呢？”</p>

<p>“那不重要。” 我这么说的时候，想起来是因为她才爱这么回答问题的。以前问她什么的时候，她最喜欢回答”那不重要”。哪怕再怎么追问，最多就多说几个字但意思还是没变，比如”那都是不重要的啊”。</p>

<p>“好像也是。不过，等你年纪大了你就会知道，有很多重要的事情你会慢慢不记得。”</p>

<p>“哦？”</p>

<p>“比如我年轻的时候认真背下来的化学元素周期表，几十年来就跟刻在脑袋里面了一样，好像是不可能忘记的。但现在才几年不用，坦白说有不少族已经模糊起来了。反而是有些看起来不重要的事情却会记得很清楚。”</p>

<p>“比如呢？”</p>

<p>“我有没有说过，我和她第一次面对面就聊了一通宵，然后跑到街上去找吃的东西？”</p>

<p>“当然有，外公，你当然有说过。那时候不像现在有那么多便利店，找了大半条街才找到一家刚刚开门的早点店，两个人一起喝了新鲜出炉的豆浆，对吧？”</p>

<p>“是啊，已经记不起来豆浆是什么味道了，但是穿过她脖子的白白的热气，在我心里好像这么多年都没有散去。”</p>

<p>“是因为除开脸，脖子是她露出来最多的地方吧？”</p>

<p>“呵呵，这么说来很遗憾啊。居然记住了白白的热气，却没记住白白的脖子。”</p>

<p>说到这里，我们俩就都笑了起来。我从一开始夹带私货，到后来真正享受起和外公一起的兰州之行，正是因为他这样一个有着非凡成就的长辈，在谈话中很少有高屋建瓴的训导之言，反而透着我父母以及其他长辈都少有的平等和坦率。</p>

<p>后来列车慢慢停了下来，我听到有人在嘟囔着定西到了。</p>

<p>“要下去走走吗？”</p>

<p>“不去了，有点儿晚了。好不容易它也停着不抖了，我就先睡会儿。如果后面想下去走再叫你吧。”</p>

<p>“那我也睡了，晚安。” 我一边爬到上铺一边说。</p>

<p>“晚安。” </p>

<p>外公答了我一句就认真地睡起觉来。我确认了一下他被子是盖好的，就也躺下来，怔怔地继续看着窗外。</p>

<p>晚安，这大概是我说过次数最多的谎话。</p>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    
  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Lenciel Li<span class="theme-version">Octopress-Lenciel 0.1</span>
  <section class="contruction-wrap">
    <div class="contruction"></div>
  </section>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'lencielgithub';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>









<!--














                                            IIIIIIIIII       I
                  II                     IIIIIIIIIIIIIIIIIIII
                  IIII                  IIIIIIIIIIIIIIIIIIII
                  IIIIII                IIIIIIIIIIIIIIIIII III
                  IIIIIIII             IIIIIIIIIIIIIIIIIIIIII
                  IIIIIIIIIII          IIIIIIIIIIIIIIIIIIIII
                  IIIIIIIIIIIIII       IIIIIIIIIIIIIIIIIII
                   IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                  I  IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                  IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                  IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                   IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                    IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                     IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                         IIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                     IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                      IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
                        IIIIIIIIIIIIIIIIIIIIIIIIIIIII
                           IIIIIIIIIIIIIIIIIIIIIIIII
                             IIIIIIIIIIIIIIIIIIIII
                          IIIIIIIIIIIIIIIIIIIIIII
                I   IIIIIIIIIIIIIIIIIIIIIIIIII
                  IIIIIIIIIIIIIIIIIIIIIIIIII
                      IIIIIIIIIIIIIIIIII















 -->


</body>
</html>
